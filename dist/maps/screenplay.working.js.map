{"version":3,"sources":["maps/screenplay.working.js"],"names":["Screenplay","settings","async","steps","waits","index","loops","indexes","markers","playing","started","animationEnd","getEventName","transitionEnd","timer","events","finale","next","_run","_trigger","pause","play","call","fn","repeat","i","push","time","length","marker","toString","nb","key","filter","f","forEach","stop","go","step","concurrentSteps","_next","bind","Array","isArray","setTimeout","elements","elementCount","done","goNext","element","self","callback","removeEventListener","HTMLElement","addEventListener","tagName","then","map","animation","transition","div","document","createElement","eventName","style","e"],"mappings":"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","file":"../screenplay.working.js","sourcesContent":["'use strict';\n\nclass Screenplay {\n    constructor (settings = {}) {\n        let {\n            async = true\n        } = settings;\n\n        this.async = async;\n        this.steps = [];\n        this.waits = [];\n        this.index = 0;\n        this.loops = 1;\n        this.indexes = [];\n        this.markers = {};\n        this.playing = false;\n        this.started = false;\n        this.animationEnd = getEventName('animation');\n        this.transitionEnd = getEventName('transition');\n        this.timer = null;\n        this.events = {\n            'step': [],\n            'play': [],\n            'stop': [],\n            'loop': [],\n            'pause': [],\n            'before': [],\n            'after': []\n        };\n        this.finale = () => {};\n    }\n\n    play(loops = this.loops) {\n        this.loops = loops;\n\n        if (!this.playing) {\n            this.playing = true;\n\n            if (this.started) {\n                this.next();\n            } else {\n                this._run();\n            }\n\n            this._trigger('play');\n        }\n\n        return this;\n    }\n\n    pause() {\n        if (this.playing) {\n            this.playing = false;\n            this._trigger('pause');\n        }\n\n        return this;\n    }\n\n    toggle() {\n        return this.playing ? this.pause() : this.play();\n    }\n\n    stop() {\n        this.loops = 1;\n        this.playing = false;\n        this.finale.call(this);\n\n        return this._trigger('stop');\n    }\n\n    step(fn, repeat = 1) {\n        for (let i = 0; i < repeat; i++) {\n            this.steps.push(fn);\n        }\n\n        return this;\n    }\n\n    wait(time) {\n        this.waits[this.steps.length - 1] = time;\n\n        return this;\n    }\n\n    end(fn) {\n        this.finale = fn;\n\n        return this;\n    }\n\n    rewind() {\n        this.index = 0;\n\n        return this._run();\n    }\n\n    marker(marker) {\n        this.markers[marker.toString()] = this.steps.length;\n\n        return this;\n    }\n\n    goto(marker) {\n        if (typeof marker === 'string') {\n            if (this.markers[marker]) {\n                this.index = this.markers[marker];\n            }\n        }\n\n        if (typeof marker === 'number') {\n            if (this.steps[marker]) {\n                this.index = this.steps[marker];\n            }\n        }\n\n        return this._run();\n    }\n\n    loop(loops = -1) {\n        this.loops = loops;\n\n        return this;\n    }\n\n    previous(nb = 1) {\n        this.index = this.index - nb;\n\n        return this._run();\n    }\n\n    next(nb = 1) {\n        this.index = this.index + nb;\n\n        return this._run();\n    }\n\n    same() {\n        return this._run();\n    }\n\n    on(key, fn) {\n        this.events[key].push(fn);\n\n        return this;\n    }\n\n    off(key, fn) {\n        if (fn) {\n            this.events[key] = this.events[key].filter((f) => f !== fn);\n        } else {\n            this.events[key] = [];\n        }\n\n        return this;\n    }\n\n    _trigger(key) {\n        this.events[key].forEach((fn) => fn.call(this));\n\n        return this;\n    }\n    _run() {\n        if (this.index < 0) {\n            this.index = 0;\n            return;\n        }\n\n        if (this.index >= this.steps.length) {\n            this.index = 0;\n\n            if (this.loops !== -1) {\n                this.loops--;\n            }\n\n            if (this.loops === 0) {\n                return this.stop();\n            }\n        }\n\n        const go = () => {\n            if (!this.started) {\n                this.started = true;\n            }\n\n            let step = this.steps[this.index],\n                steps = step;\n\n            if (typeof step === 'function') {\n                this.concurrentSteps = 1;\n\n                step.call(this, this._next.bind(this));\n            }\n\n            if (Array.isArray(steps)) {\n                this.concurrentSteps = steps.length;\n\n                steps.forEach((step) => {\n                    step.call(this, this._next.bind(this));\n                });\n            }\n        };\n\n        this._trigger('before');\n\n        if (this.async) {\n            setTimeout(go);\n        } else {\n            go();\n        }\n\n        return this;\n    }\n\n    _next(elements) {\n        let elementCount = 0;\n\n        let done = () => {\n            let goNext = () => {\n                this.index++;\n                this._run();\n                this._trigger('after');\n            };\n\n            if (--this.concurrentSteps === 0) {\n                if (this.playing) {\n                    if (this.waits[this.index]) {\n                        setTimeout(function () {\n                            goNext();\n                        }, this.waits[this.index]);\n                    } else {\n                        goNext();\n                    }\n                }\n            }\n        };\n\n        if (elements) {\n            elements = Array.isArray(elements) ? elements : [ elements ];\n\n            elements.forEach((element) => {\n                let self = this;\n\n                function callback () {\n                    element.removeEventListener(self.animationEnd,  callback, false);\n                    element.removeEventListener(self.transitionEnd, callback, false);\n                    element.removeEventListener(\"ended\", callback, false);\n\n                    if (++elementCount === elements.length) {\n                        done();\n                    }\n                }\n\n                if (typeof HTMLElement !== 'undefined' && element instanceof HTMLElement) {\n                    element.addEventListener(this.animationEnd,  callback, false);\n                    element.addEventListener(this.transitionEnd, callback, false);\n\n                    if (element.tagName === 'AUDIO' || element.tagName === 'VIDEO') {\n                        element.addEventListener(\"ended\", callback, false);\n                    }\n                }\n\n                if (typeof element.then === 'function') {\n                    element.then(done, done);\n                }\n            });\n        } else {\n            done();\n        }\n\n        return this;\n    }\n}\n\nfunction getEventName (key) {\n    const map = {\n        animation: {\n            'animation': 'animationend',\n            '-o-animation': 'oAnimationEnd',\n            '-moz-animation': 'animationend',\n            '-webkit-animation': 'webkitAnimationEnd'\n        },\n        transition: {\n            'transition': 'transitionend',\n            '-o-transition': 'oTransitionEnd',\n            '-moz-transition': 'transitionend',\n            '-webkit-transition': 'webkitTransitionEnd'\n        }\n    };\n\n    try {\n        let div = document.createElement('div');\n\n        for (let eventName in map[key]) {\n            if (typeof(div.style[eventName]) !== 'undefined') {\n                return map[key][eventName];\n            }\n        }\n    } catch (e) {\n        return null;\n    }\n}\n\nexport default Screenplay;\n"]}