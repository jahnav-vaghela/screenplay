{"version":3,"sources":["maps/maps/screenplay.js"],"names":["getEventName","key","map","animation","-o-animation","-moz-animation","-webkit-animation","transition","-o-transition","-moz-transition","-webkit-transition","div","document","createElement","eventName","style","e","Screenplay","settings","arguments","length","undefined","_classCallCheck","this","_settings$async","async","steps","index","loops","indexes","markers","playing","animationEnd","transitionEnd","timer","events","step","play","stop","loop","pause","before","after","finale","run","trigger","call","fn","repeat","i","push","time","next","clearTimeout","setTimeout","last","marker","toString","filter","f","_this","forEach","nb","_reverseIndex","_this2","go","concurrentSteps","_next","bind","Array","isArray","elements","_this3","elementCount","done","element","callback","removeEventListener","self","HTMLElement","addEventListener","tagName","then","previous","buffer"],"mappings":"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","file":"../screenplay.min.js","sourcesContent":["'use strict';\n\nclass Screenplay {\n    constructor (settings = {}) {\n        let {\n            async = true\n        } = settings;\n\n        this.async = async;\n        this.steps = [];\n        this.index = 0;\n        this.loops = 1;\n        this.indexes = [];\n        this.markers = {};\n        this.playing = false;\n        this.animationEnd = getEventName('animation');\n        this.transitionEnd = getEventName('transition');\n        this.timer = null;\n        this.events = {\n            'step': [],\n            'play': [],\n            'stop': [],\n            'loop': [],\n            'pause': [],\n            'before': [],\n            'after': []\n        };\n        this.finale = () => {};\n    }\n\n    play(loops = this.loops) {\n        this.loops = loops;\n        this.playing = true;\n        this.run();\n\n        return this.trigger('play');\n    }\n\n    pause() {\n        this.playing = false;\n        this.run();\n\n        return this.trigger('pause');\n    }\n\n    toggle() {\n        return this.playing ? this.pause() : this.play();\n    }\n\n    stop() {\n        this.loops = 1;\n        this.playing = false;\n        this.finale.call(this);\n\n        return this.trigger('stop');\n    }\n\n    step(fn, repeat = 1) {\n        for (let i = 0; i < repeat; i++) {\n            this.steps.push(fn);\n            this.indexes.push(this.steps.length - 1);\n        }\n\n        return this;\n    }\n\n    wait(time) {\n        this.steps.push(function (next) {\n            clearTimeout(this.timer);\n\n            this.timer = setTimeout(function () {\n                next();\n            }, time);\n        });\n\n        return this;\n    }\n\n    repeat(repeat) {\n        let last = this.steps[this.steps.length - 1];\n\n        return this.step(last, repeat);\n    }\n\n    end(fn) {\n        this.finale = fn;\n\n        return this;\n    }\n\n    rewind() {\n        this.index = 0;\n        this.playing = true;\n        this.run();\n\n        return this;\n    }\n\n    marker(marker) {\n        this.markers[marker.toString()] = this.steps.length;\n\n        return this;\n    }\n\n    goto(marker) {\n        if (typeof marker === 'string') {\n            if (this.markers[marker]) {\n                this.index = this.markers[marker];\n                this.run();\n            }\n        }\n\n        if (typeof marker === 'number') {\n            if (this.indexes[marker]) {\n                this.index = this.indexes[marker];\n                this.run();\n            }\n        }\n\n        return this;\n    }\n\n    on(key, fn) {\n        this.events[key].push(fn);\n\n        return this;\n    }\n\n    off(key, fn) {\n        if (fn) {\n            this.events[key] = this.events[key].filter((f) => f !== fn);\n        } else {\n            this.events[key] = [];\n        }\n\n        return this;\n    }\n\n    trigger(key) {\n        this.events[key].forEach((fn) => fn.call(this));\n\n        return this;\n    }\n\n    loop(loops = -1) {\n        this.loops = loops;\n\n        return this;\n    }\n\n    previous(nb = 1) {\n        let index = this._reverseIndex(this.index - nb, true);\n\n        if (index) {\n            this.index = index;\n            this.run();\n        }\n\n        return this;\n    }\n\n    next(nb = 1) {\n        let index = this._reverseIndex(this.index + nb);\n\n        if (index) {\n            this.index = index;\n            this.run();\n        }\n\n        return this;\n    }\n\n    same() {\n        this.index -= 1;\n        this.run();\n\n        return this;\n    }\n\n    run() {\n        if (!this.playing) {\n            return;\n        }\n\n        if (this.index < 0) {\n            this.index = 0;\n        }\n\n        if (this.index >= this.steps.length) {\n            this.index = 0;\n\n            if (this.loops !== -1) {\n                this.loops--;\n            }\n\n            if (this.loops === 0) {\n                return this.stop();\n            }\n        }\n\n        const go = () => {\n            let step = this.steps[this.index],\n                steps = step;\n\n            if (typeof step === 'function') {\n                this.concurrentSteps = 1;\n\n                step.call(this, this._next.bind(this));\n            }\n\n            if (Array.isArray(steps)) {\n                this.concurrentSteps = steps.length;\n\n                steps.forEach((step) => {\n                    step.call(this, this._next.bind(this));\n                });\n            }\n        };\n\n        this.trigger('before');\n\n        if (this.async) {\n            setTimeout(go);\n        } else {\n            go();\n        }\n\n        return this;\n    }\n\n    _next(elements) {\n        let elementCount = 0;\n\n        let done = () => {\n            if (--this.concurrentSteps === 0) {\n                this.index++;\n                this.run();\n                this.trigger('after');\n            }\n        };\n\n        if (elements) {\n            elements = Array.isArray(elements) ? elements : [ elements ];\n\n            elements.forEach((element) => {\n                let self = this;\n\n                function callback () {\n                    element.removeEventListener(self.animationEnd,  callback, false);\n                    element.removeEventListener(self.transitionEnd, callback, false);\n                    element.removeEventListener(\"ended\", callback, false);\n\n                    if (++elementCount === elements.length) {\n                        done();\n                    }\n                }\n\n                if (typeof HTMLElement !== 'undefined' && element instanceof HTMLElement) {\n                    element.addEventListener(this.animationEnd,  callback, false);\n                    element.addEventListener(this.transitionEnd, callback, false);\n\n                    if (element.tagName === 'AUDIO' || element.tagName === 'VIDEO') {\n                        element.addEventListener(\"ended\", callback, false);\n                    }\n                }\n\n                if (typeof element.then === 'function') {\n                    element.then(done, done);\n                }\n            });\n        } else {\n            done();\n        }\n\n        return this;\n    }\n\n    _reverseIndex(index, previous) {\n        let buffer;\n\n        for (let i = 0; i < this.indexes.length; i++) {\n            if ((previous && this.indexes[i] >= index) || (!previous && this.indexes[i] > index)) {\n                return buffer;\n            }\n            buffer = this.indexes[i];\n        }\n\n        return 0;\n    }\n}\n\nfunction getEventName (key) {\n    const map = {\n        animation: {\n            'animation': 'animationend',\n            '-o-animation': 'oAnimationEnd',\n            '-moz-animation': 'animationend',\n            '-webkit-animation': 'webkitAnimationEnd'\n        },\n        transition: {\n            'transition': 'transitionend',\n            '-o-transition': 'oTransitionEnd',\n            '-moz-transition': 'transitionend',\n            '-webkit-transition': 'webkitTransitionEnd'\n        }\n    };\n\n    try {\n        let div = document.createElement('div');\n\n        for (let eventName in map[key]) {\n            if (typeof(div.style[eventName]) !== 'undefined') {\n                return map[key][eventName];\n            }\n        }\n    } catch (e) {\n        return null;\n    }\n}\n\nexport default Screenplay;\n"]}