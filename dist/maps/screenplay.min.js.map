{"version":3,"sources":["maps/maps/screenplay.js"],"names":["getEventName","key","map","animation","-o-animation","-moz-animation","-webkit-animation","transition","-o-transition","-moz-transition","-webkit-transition","div","document","createElement","eventName","style","e","Screenplay","settings","arguments","length","undefined","_classCallCheck","this","_settings$async","async","_settings$direction","direction","_settings$loops","loops","_settings$loopBackwar","loopBackward","steps","waits","index","loopBuffer","dir","inited","playing","timer1","timer2","markers","animationEnd","transitionEnd","events","init","play","stop","start","loop","pause","before","after","finale","_trigger","_run","next","_break","call","fn","nb","repeat","i","push","time","marker","toString","filter","f","_this","forEach","started","clearTimeout","_this2","go","step","concurrentSteps","_next","bind","Array","isArray","setTimeout","elements","_this3","elementCount","done","element","callback","removeEventListener","self","HTMLElement","addEventListener","tagName","then"],"mappings":"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","file":"../screenplay.min.js","sourcesContent":["'use strict';\n\nclass Screenplay {\n    constructor (settings = {}) {\n        let {\n            async = false,\n            direction = 1,\n            loops = 1,\n            loopBackward = false,\n        } = settings;\n\n        this.steps = [];\n        this.waits = [];\n        this.async = async;\n        this.index = 0;\n        this.loops = loops;\n        this.loopBackward = loopBackward;\n        this.loopBuffer = loops;\n        this.dir = direction;\n        this.inited = false;\n        this.playing = false;\n        this.timer1 = null;\n        this.timer2 = null;\n        this.markers = {};\n        this.animationEnd = getEventName('animation');\n        this.transitionEnd = getEventName('transition');\n        this.events = {\n            'init': [],\n            'play': [],\n            'stop': [],\n            'start': [],\n            'loop': [],\n            'pause': [],\n            'before': [],\n            'after': []\n        };\n        this.finale = () => {};\n    }\n\n    init() {\n        this.inited = true;\n        this.playing = false;\n\n        if (this.dir === -1) {\n            this.index = this.steps.length - 1;\n        } else {\n            this.index = 0;\n        }\n\n        this._trigger('init');\n\n        this._run();\n\n        return this;\n    }\n\n    play(loops = this.loops) {\n        this.loops = loops;\n        this.loopBuffer = loops;\n\n        if (!this.playing) {\n            this.playing = true;\n\n            this._trigger('play');\n\n            if (this.inited) {\n                this.next();\n            } else {\n                this.inited = true;\n\n                if (this.dir === -1) {\n                    this.index = this.steps.length - 1;\n                } else {\n                    this.index = 0;\n                }\n\n                this._run();\n            }\n        }\n\n        return this;\n    }\n\n    pause() {\n        if (this.playing) {\n            this.playing = false;\n\n            this._break();\n            this._trigger('pause');\n        }\n\n        return this;\n    }\n\n    toggle() {\n        return this.playing ? this.pause() : this.play();\n    }\n\n    stop() {\n        if (this.inited) {\n            this.playing = false;\n            this.inited = false;\n\n            this._break();\n            this._trigger('stop');\n\n            this.finale.call(this);\n        }\n\n        return this;\n    }\n\n    done(fn) {\n        this.finale = fn;\n\n        return this;\n    }\n\n    previous(nb = 1) {\n        if (this.inited) {\n            this.index = this.index - (nb * this.dir);\n            this._run();\n        }\n\n        return this;\n    }\n\n    next(nb = 1) {\n        if (this.inited) {\n            this.index = this.index + (nb * this.dir);\n            this._run();\n        }\n\n        return this;\n    }\n\n    same() {\n        this._run();\n\n        return this;\n    }\n\n    rewind() {\n        this.index = (this.dir === -1) ? this.steps.length - 1 : 0;\n\n        return this._run();\n    }\n\n    loop(loops = -1, loopBackward = this.loopBackward) {\n        this.loops = loops;\n        this.loopBackward = loopBackward;\n        this.loopBuffer = loops;\n\n        return this;\n    }\n\n    index(index) {\n        if (index === undefined) {\n            return this.index;\n        }\n        this.index = index;\n\n        return this;\n    }\n\n    direction(direction) {\n        if (direction === undefined) {\n            return this.dir;\n        }\n        this.dir = direction;\n\n        return this;\n    }\n\n    reverse() {\n        return this.direction(this.dir * -1);\n    }\n\n    step(fn, repeat = 1) {\n        for (let i = 0; i < repeat; i++) {\n            this.steps.push(fn);\n        }\n\n        return this;\n    }\n\n    wait(time) {\n        this.waits[this.steps.length - 1] = time;\n\n        if (time) {\n            this.async = true;\n        }\n\n        return this;\n    }\n\n    marker(marker) {\n        this.markers[marker.toString()] = this.steps.length;\n\n        return this;\n    }\n\n    goto(marker) {\n        if (typeof marker === 'string') {\n            if (this.markers[marker]) {\n                this.index = this.markers[marker];\n            }\n        }\n\n        if (typeof marker === 'number') {\n            if (this.steps[marker]) {\n                this.index = this.steps[marker];\n            }\n        }\n\n        return this._run();\n    }\n\n    on(key, fn) {\n        this.events[key].push(fn);\n\n        return this;\n    }\n\n    off(key, fn) {\n        if (fn) {\n            this.events[key] = this.events[key].filter((f) => f !== fn);\n        } else {\n            this.events[key] = [];\n        }\n\n        return this;\n    }\n\n    _trigger(key) {\n        this.events[key].forEach((fn) => fn.call(this));\n\n        return this;\n    }\n\n    _break() {\n        if (this.started) {\n            this.started = false;\n            this._trigger('after');\n        }\n\n        clearTimeout(this.timer1);\n        clearTimeout(this.timer2);\n    }\n\n    _run() {\n        if (this.index < 0) {\n            if (this.loops !== -1) {\n                if (this.dir === -1 || (this.dir === 1 && this.loopBackward)) {\n                    this.index = this.steps.length - 1;\n                    this.loops = this.loops + this.dir;\n                } else {\n                    return this.stop();\n                }\n            } else {\n                this.index = this.steps.length - 1;\n            }\n\n            if (this.loops === 0 || this.loops > this.loopBuffer) {\n                return this.stop();\n            } else {\n                this._trigger('loop');\n            }\n        }\n\n        if (this.index >= this.steps.length) {\n            if (this.loops !== -1) {\n                if (this.dir === 1 || (this.dir === -1 && this.loopBackward)) {\n                    this.index = 0;\n                    this.loops = this.loops - this.dir;\n                } else {\n                    return this.stop();\n                }\n            } else {\n                this.index = 0;\n            }\n\n            if (this.loops === 0 || this.loops > this.loopBuffer) {\n                return this.stop();\n            } else {\n                this._trigger('loop');\n            }\n        }\n\n        let go = () => {\n            let step = this.steps[this.index],\n                steps = step;\n\n            this.started = true;\n            this._trigger('before');\n\n            if (typeof step === 'function') {\n                this.concurrentSteps = 1;\n\n                step.call(this, this._next.bind(this));\n            }\n\n            if (Array.isArray(steps)) {\n                this.concurrentSteps = steps.length;\n\n                steps.forEach((step) => {\n                    step.call(this, this._next.bind(this));\n                });\n            }\n        };\n\n        if (this.async) {\n            clearTimeout(this.timer1);\n\n            this.timer1 = setTimeout(go);\n        } else {\n            go();\n        }\n\n        return this;\n    }\n\n    _next(elements) {\n        let elementCount = 0;\n\n        if (!this.playing) {\n            this._trigger('after');\n            return;\n        }\n\n        let go = () => {\n            if (this.started) {\n                this.started = false;\n                this._trigger('after');\n            }\n\n            this.index = this.index + this.dir;\n            this._run();\n        };\n\n        let done = () => {\n            if (--this.concurrentSteps <= 0) {\n                if (this.async) {\n                    clearTimeout(this.timer2);\n\n                    this.timer2 = setTimeout(go, this.waits[this.index]);\n                } else {\n                    go();\n                }\n            }\n        };\n\n        if (elements) {\n            elements = Array.isArray(elements) ? elements : [ elements ];\n\n            elements.forEach((element) => {\n                let self = this;\n\n                function callback () {\n                    element.removeEventListener(self.animationEnd,  callback, false);\n                    element.removeEventListener(self.transitionEnd, callback, false);\n                    element.removeEventListener(\"ended\", callback, false);\n\n                    if (++elementCount === elements.length) {\n                        done();\n                    }\n                }\n\n                if (typeof HTMLElement !== 'undefined' && element instanceof HTMLElement) {\n                    element.addEventListener(this.animationEnd,  callback, false);\n                    element.addEventListener(this.transitionEnd, callback, false);\n\n                    if (element.tagName === 'AUDIO' || element.tagName === 'VIDEO') {\n                        element.addEventListener(\"ended\", callback, false);\n                    }\n                }\n\n                if (typeof element.then === 'function') {\n                    element.then(done, done);\n                }\n            });\n        } else {\n            done();\n        }\n\n        return this;\n    }\n}\n\nfunction getEventName (key) {\n    const map = {\n        animation: {\n            'animation': 'animationend',\n            '-o-animation': 'oAnimationEnd',\n            '-moz-animation': 'animationend',\n            '-webkit-animation': 'webkitAnimationEnd'\n        },\n        transition: {\n            'transition': 'transitionend',\n            '-o-transition': 'oTransitionEnd',\n            '-moz-transition': 'transitionend',\n            '-webkit-transition': 'webkitTransitionEnd'\n        }\n    };\n\n    try {\n        let div = document.createElement('div');\n\n        for (let eventName in map[key]) {\n            if (typeof(div.style[eventName]) !== 'undefined') {\n                return map[key][eventName];\n            }\n        }\n    } catch (e) {\n        return null;\n    }\n}\n\nexport default Screenplay;\n"]}