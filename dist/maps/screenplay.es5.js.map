{"version":3,"sources":["maps/screenplay.es5.js"],"names":["context","factory","module","exports","define","amd","Screenplay","settings","async","steps","index","loops","indexes","markers","playing","animationEnd","getEventName","transitionEnd","timer","events","finale","run","trigger","pause","play","call","fn","repeat","i","push","length","time","next","clearTimeout","setTimeout","last","step","marker","toString","key","filter","f","forEach","nb","_reverseIndex","stop","go","concurrentSteps","_next","bind","Array","isArray","doms","domCount","done","dom","self","callback","removeEventListener","addEventListener","previous","buffer","map","animation","transition","div","document","createElement","eventName","style","e"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AAEA,KAAC,UAAUA,OAAV,EAAmBC,OAAnB,EAA4B;AACzB;;AAEA,YAAI,OAAOC,MAAP,KAAkB,WAAlB,IAAiCA,OAAOC,OAA5C,EAAqD;AACjDD,mBAAOC,OAAP,GAAiBF,SAAjB;AACH,SAFD,MAEO,IAAI,OAAOG,MAAP,KAAkB,UAAlB,IAAgCA,OAAOC,GAA3C,EAAgD;AACnDD,mBAAO,EAAP,EAAWH,OAAX;AACH,SAFM,MAEA;AACHD,oBAAQM,UAAR,GAAqBL,SAArB;AACH;AACJ,KAVD,aAUS,YAAY;AACjB;;AADiB,YAGXK,UAHW;AAIb,kCAA4B;AAAA,oBAAfC,QAAe,uEAAJ,EAAI;;AAAA;;AAAA,sCAGpBA,QAHoB,CAEpBC,KAFoB;AAAA,oBAEpBA,KAFoB,mCAEZ,IAFY;;;AAKxB,qBAAKA,KAAL,GAAaA,KAAb;AACA,qBAAKC,KAAL,GAAa,EAAb;AACA,qBAAKC,KAAL,GAAa,CAAb;AACA,qBAAKC,KAAL,GAAa,CAAb;AACA,qBAAKC,OAAL,GAAe,EAAf;AACA,qBAAKC,OAAL,GAAe,EAAf;AACA,qBAAKC,OAAL,GAAe,KAAf;AACA,qBAAKC,YAAL,GAAoBC,aAAa,WAAb,CAApB;AACA,qBAAKC,aAAL,GAAqBD,aAAa,YAAb,CAArB;AACA,qBAAKE,KAAL,GAAa,IAAb;AACA,qBAAKC,MAAL,GAAc;AACV,4BAAQ,EADE;AAEV,4BAAQ,EAFE;AAGV,4BAAQ,EAHE;AAIV,4BAAQ,EAJE;AAKV,6BAAS,EALC;AAMV,8BAAU,EANA;AAOV,6BAAS;AAPC,iBAAd;AASA,qBAAKC,MAAL,GAAc,YAAM,CAAE,CAAtB;AACH;;AA7BY;AAAA;AAAA,uCA+BY;AAAA,wBAApBT,KAAoB,uEAAZ,KAAKA,KAAO;;AACrB,yBAAKA,KAAL,GAAaA,KAAb;AACA,yBAAKG,OAAL,GAAe,IAAf;AACA,yBAAKO,GAAL;;AAEA,2BAAO,KAAKC,OAAL,CAAa,MAAb,CAAP;AACH;AArCY;AAAA;AAAA,wCAuCL;AACJ,yBAAKR,OAAL,GAAe,KAAf;AACA,yBAAKO,GAAL;;AAEA,2BAAO,KAAKC,OAAL,CAAa,OAAb,CAAP;AACH;AA5CY;AAAA;AAAA,yCA8CJ;AACL,2BAAO,KAAKR,OAAL,GAAe,KAAKS,KAAL,EAAf,GAA8B,KAAKC,IAAL,EAArC;AACH;AAhDY;AAAA;AAAA,uCAkDN;AACH,yBAAKb,KAAL,GAAa,CAAb;AACA,yBAAKG,OAAL,GAAe,KAAf;AACA,yBAAKM,MAAL,CAAYK,IAAZ,CAAiB,IAAjB;;AAEA,2BAAO,KAAKH,OAAL,CAAa,MAAb,CAAP;AACH;AAxDY;AAAA;AAAA,qCA0DRI,EA1DQ,EA0DQ;AAAA,wBAAZC,MAAY,uEAAH,CAAG;;AACjB,yBAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAID,MAApB,EAA4BC,GAA5B,EAAiC;AAC7B,6BAAKnB,KAAL,CAAWoB,IAAX,CAAgBH,EAAhB;AACA,6BAAKd,OAAL,CAAaiB,IAAb,CAAkB,KAAKpB,KAAL,CAAWqB,MAAX,GAAoB,CAAtC;AACH;;AAED,2BAAO,IAAP;AACH;AAjEY;AAAA;AAAA,qCAmERC,IAnEQ,EAmEF;AACP,yBAAKtB,KAAL,CAAWoB,IAAX,CAAgB,UAAUG,IAAV,EAAgB;AAC5BC,qCAAa,KAAKf,KAAlB;;AAEA,6BAAKA,KAAL,GAAagB,WAAW,YAAY;AAChCF;AACH,yBAFY,EAEVD,IAFU,CAAb;AAGH,qBAND;;AAQA,2BAAO,IAAP;AACH;AA7EY;AAAA;AAAA,uCA+ENJ,OA/EM,EA+EE;AACX,wBAAIQ,OAAO,KAAK1B,KAAL,CAAW,KAAKA,KAAL,CAAWqB,MAAX,GAAoB,CAA/B,CAAX;;AAEA,2BAAO,KAAKM,IAAL,CAAUD,IAAV,EAAgBR,OAAhB,CAAP;AACH;AAnFY;AAAA;AAAA,oCAqFTD,EArFS,EAqFL;AACJ,yBAAKN,MAAL,GAAcM,EAAd;;AAEA,2BAAO,IAAP;AACH;AAzFY;AAAA;AAAA,yCA2FJ;AACL,yBAAKhB,KAAL,GAAa,CAAb;AACA,yBAAKI,OAAL,GAAe,IAAf;AACA,yBAAKO,GAAL;;AAEA,2BAAO,IAAP;AACH;AAjGY;AAAA;AAAA,uCAmGNgB,OAnGM,EAmGE;AACX,yBAAKxB,OAAL,CAAawB,QAAOC,QAAP,EAAb,IAAkC,KAAK7B,KAAL,CAAWqB,MAA7C;;AAEA,2BAAO,IAAP;AACH;AAvGY;AAAA;AAAA,qCAyGRO,MAzGQ,EAyGA;AACT,wBAAI,OAAOA,MAAP,KAAkB,QAAtB,EAAgC;AAC5B,4BAAI,KAAKxB,OAAL,CAAawB,MAAb,CAAJ,EAA0B;AACtB,iCAAK3B,KAAL,GAAa,KAAKG,OAAL,CAAawB,MAAb,CAAb;AACA,iCAAKhB,GAAL;AACH;AACJ;;AAED,wBAAI,OAAOgB,MAAP,KAAkB,QAAtB,EAAgC;AAC5B,4BAAI,KAAKzB,OAAL,CAAayB,MAAb,CAAJ,EAA0B;AACtB,iCAAK3B,KAAL,GAAa,KAAKE,OAAL,CAAayB,MAAb,CAAb;AACA,iCAAKhB,GAAL;AACH;AACJ;;AAED,2BAAO,IAAP;AACH;AAzHY;AAAA;AAAA,mCA2HVkB,GA3HU,EA2HLb,EA3HK,EA2HD;AACR,yBAAKP,MAAL,CAAYoB,GAAZ,EAAiBV,IAAjB,CAAsBH,EAAtB;;AAEA,2BAAO,IAAP;AACH;AA/HY;AAAA;AAAA,oCAiITa,GAjIS,EAiIJb,EAjII,EAiIA;AACT,wBAAIA,EAAJ,EAAQ;AACJ,6BAAKP,MAAL,CAAYoB,GAAZ,IAAmB,KAAKpB,MAAL,CAAYoB,GAAZ,EAAiBC,MAAjB,CAAwB,UAACC,CAAD;AAAA,mCAAOA,MAAMf,EAAb;AAAA,yBAAxB,CAAnB;AACH,qBAFD,MAEO;AACH,6BAAKP,MAAL,CAAYoB,GAAZ,IAAmB,EAAnB;AACH;;AAED,2BAAO,IAAP;AACH;AAzIY;AAAA;AAAA,wCA2ILA,GA3IK,EA2IA;AAAA;;AACT,yBAAKpB,MAAL,CAAYoB,GAAZ,EAAiBG,OAAjB,CAAyB,UAAChB,EAAD;AAAA,+BAAQA,GAAGD,IAAH,OAAR;AAAA,qBAAzB;;AAEA,2BAAO,IAAP;AACH;AA/IY;AAAA;AAAA,uCAiJI;AAAA,wBAAZd,KAAY,uEAAJ,CAAC,CAAG;;AACb,yBAAKA,KAAL,GAAaA,KAAb;;AAEA,2BAAO,IAAP;AACH;AArJY;AAAA;AAAA,2CAuJI;AAAA,wBAARgC,EAAQ,uEAAH,CAAG;;AACb,wBAAIjC,QAAQ,KAAKkC,aAAL,CAAmB,KAAKlC,KAAL,GAAaiC,EAAhC,EAAoC,IAApC,CAAZ;;AAEA,wBAAIjC,KAAJ,EAAW;AACP,6BAAKA,KAAL,GAAaA,KAAb;AACA,6BAAKW,GAAL;AACH;;AAED,2BAAO,IAAP;AACH;AAhKY;AAAA;AAAA,uCAkKA;AAAA,wBAARsB,EAAQ,uEAAH,CAAG;;AACT,wBAAIjC,QAAQ,KAAKkC,aAAL,CAAmB,KAAKlC,KAAL,GAAaiC,EAAhC,CAAZ;;AAEA,wBAAIjC,KAAJ,EAAW;AACP,6BAAKA,KAAL,GAAaA,KAAb;AACA,6BAAKW,GAAL;AACH;;AAED,2BAAO,IAAP;AACH;AA3KY;AAAA;AAAA,uCA6KN;AACH,yBAAKX,KAAL,IAAc,CAAd;AACA,yBAAKW,GAAL;;AAEA,2BAAO,IAAP;AACH;AAlLY;AAAA;AAAA,sCAoLP;AAAA;;AACF,wBAAI,CAAC,KAAKP,OAAV,EAAmB;AACf;AACH;;AAED,wBAAI,KAAKJ,KAAL,GAAa,CAAjB,EAAoB;AAChB,6BAAKA,KAAL,GAAa,CAAb;AACH;;AAED,wBAAI,KAAKA,KAAL,IAAc,KAAKD,KAAL,CAAWqB,MAA7B,EAAqC;AACjC,6BAAKpB,KAAL,GAAa,CAAb;;AAEA,4BAAI,KAAKC,KAAL,KAAe,CAAC,CAApB,EAAuB;AACnB,iCAAKA,KAAL;AACH;;AAED,4BAAI,KAAKA,KAAL,KAAe,CAAnB,EAAsB;AAClB,mCAAO,KAAKkC,IAAL,EAAP;AACH;AACJ;;AAED,wBAAMC,KAAK,SAALA,EAAK,GAAM;AACb,4BAAIV,OAAO,OAAK3B,KAAL,CAAW,OAAKC,KAAhB,CAAX;AAAA,4BACID,QAAQ2B,IADZ;;AAGA,4BAAI,OAAOA,IAAP,KAAgB,UAApB,EAAgC;AAC5B,mCAAKW,eAAL,GAAuB,CAAvB;;AAEAX,iCAAKX,IAAL,SAAgB,OAAKuB,KAAL,CAAWC,IAAX,QAAhB;AACH;;AAED,4BAAIC,MAAMC,OAAN,CAAc1C,KAAd,CAAJ,EAA0B;AACtB,mCAAKsC,eAAL,GAAuBtC,MAAMqB,MAA7B;;AAEArB,kCAAMiC,OAAN,CAAc,UAACN,IAAD,EAAU;AACpBA,qCAAKX,IAAL,SAAgB,OAAKuB,KAAL,CAAWC,IAAX,QAAhB;AACH,6BAFD;AAGH;AACJ,qBAjBD;;AAmBA,yBAAK3B,OAAL,CAAa,QAAb;;AAEA,wBAAI,KAAKd,KAAT,EAAgB;AACZ0B,mCAAWY,EAAX;AACH,qBAFD,MAEO;AACHA;AACH;;AAED,2BAAO,IAAP;AACH;AArOY;AAAA;AAAA,sCAuOPM,IAvOO,EAuOD;AAAA;;AACR,wBAAIC,WAAW,CAAf;;AAEA,wBAAIC,OAAO,SAAPA,IAAO,GAAM;AACb,4BAAI,EAAE,OAAKP,eAAP,KAA2B,CAA/B,EAAkC;AAC9B,mCAAKrC,KAAL;AACA,mCAAKW,GAAL;AACA,mCAAKC,OAAL,CAAa,OAAb;AACH;AACJ,qBAND;;AAQA,wBAAI8B,IAAJ,EAAU;AACNA,+BAAOF,MAAMC,OAAN,CAAcC,IAAd,IAAsBA,IAAtB,GAA6B,CAAEA,IAAF,CAApC;;AAEAA,6BAAKV,OAAL,CAAa,UAACa,GAAD,EAAS;AAClB,gCAAIC,aAAJ;;AAEA,qCAASC,QAAT,GAAqB;AACjBF,oCAAIG,mBAAJ,CAAwBF,KAAKzC,YAA7B,EAA4C0C,QAA5C,EAAsD,KAAtD;AACAF,oCAAIG,mBAAJ,CAAwBF,KAAKvC,aAA7B,EAA4CwC,QAA5C,EAAsD,KAAtD;;AAEA,oCAAI,EAAEJ,QAAF,KAAeD,KAAKtB,MAAxB,EAAgC;AAC5BwB;AACH;AACJ;;AAEDC,gCAAII,gBAAJ,CAAqB,OAAK5C,YAA1B,EAAyC0C,QAAzC,EAAmD,KAAnD;AACAF,gCAAII,gBAAJ,CAAqB,OAAK1C,aAA1B,EAAyCwC,QAAzC,EAAmD,KAAnD;AACH,yBAdD;AAeH,qBAlBD,MAkBO;AACHH;AACH;;AAED,2BAAO,IAAP;AACH;AAzQY;AAAA;AAAA,8CA2QC5C,KA3QD,EA2QQkD,QA3QR,EA2QkB;AAC3B,wBAAIC,eAAJ;;AAEA,yBAAK,IAAIjC,IAAI,CAAb,EAAgBA,IAAI,KAAKhB,OAAL,CAAakB,MAAjC,EAAyCF,GAAzC,EAA8C;AAC1C,4BAAKgC,YAAY,KAAKhD,OAAL,CAAagB,CAAb,KAAmBlB,KAAhC,IAA2C,CAACkD,QAAD,IAAa,KAAKhD,OAAL,CAAagB,CAAb,IAAkBlB,KAA9E,EAAsF;AAClF,mCAAOmD,MAAP;AACH;AACDA,iCAAS,KAAKjD,OAAL,CAAagB,CAAb,CAAT;AACH;;AAED,2BAAO,CAAP;AACH;AAtRY;;AAAA;AAAA;;AAyRjB,iBAASZ,YAAT,CAAuBuB,GAAvB,EAA4B;AACxB,gBAAMuB,MAAM;AACRC,2BAAW;AACP,iCAAa,cADN;AAEP,oCAAgB,eAFT;AAGP,sCAAkB,cAHX;AAIP,yCAAqB;AAJd,iBADH;AAORC,4BAAY;AACR,kCAAc,eADN;AAER,qCAAiB,gBAFT;AAGR,uCAAmB,eAHX;AAIR,0CAAsB;AAJd;AAPJ,aAAZ;;AAeA,gBAAI;AACA,oBAAIC,MAAMC,SAASC,aAAT,CAAuB,KAAvB,CAAV;;AAEA,qBAAK,IAAIC,SAAT,IAAsBN,IAAIvB,GAAJ,CAAtB,EAAgC;AAC5B,wBAAI,OAAO0B,IAAII,KAAJ,CAAUD,SAAV,CAAP,KAAiC,WAArC,EAAkD;AAC9C,+BAAON,IAAIvB,GAAJ,EAAS6B,SAAT,CAAP;AACH;AACJ;AACJ,aARD,CAQE,OAAOE,CAAP,EAAU;AACR,uBAAO,IAAP;AACH;AACJ;;AAED,eAAOhE,UAAP;AACH,KAjUD","file":"../screenplay.es5.js","sourcesContent":["/* global define */\n\n(function (context, factory) {\n    'use strict';\n\n    if (typeof module !== 'undefined' && module.exports) {\n        module.exports = factory();\n    } else if (typeof define === 'function' && define.amd) {\n        define([], factory);\n    } else {\n        context.Screenplay = factory();\n    }\n})(this, function () {\n    'use strict';\n\n    class Screenplay {\n        constructor (settings = {}) {\n            let {\n                async = true\n            } = settings;\n\n            this.async = async;\n            this.steps = [];\n            this.index = 0;\n            this.loops = 1;\n            this.indexes = [];\n            this.markers = {};\n            this.playing = false;\n            this.animationEnd = getEventName('animation');\n            this.transitionEnd = getEventName('transition');\n            this.timer = null;\n            this.events = {\n                'step': [],\n                'play': [],\n                'stop': [],\n                'loop': [],\n                'pause': [],\n                'before': [],\n                'after': []\n            };\n            this.finale = () => {};\n        }\n\n        play(loops = this.loops) {\n            this.loops = loops;\n            this.playing = true;\n            this.run();\n\n            return this.trigger('play');\n        }\n\n        pause() {\n            this.playing = false;\n            this.run();\n\n            return this.trigger('pause');\n        }\n\n        toggle() {\n            return this.playing ? this.pause() : this.play();\n        }\n\n        stop() {\n            this.loops = 1;\n            this.playing = false;\n            this.finale.call(this);\n\n            return this.trigger('stop');\n        }\n\n        step(fn, repeat = 1) {\n            for (let i = 0; i < repeat; i++) {\n                this.steps.push(fn);\n                this.indexes.push(this.steps.length - 1);\n            }\n\n            return this;\n        }\n\n        wait(time) {\n            this.steps.push(function (next) {\n                clearTimeout(this.timer);\n\n                this.timer = setTimeout(function () {\n                    next();\n                }, time);\n            });\n\n            return this;\n        }\n\n        repeat(repeat) {\n            let last = this.steps[this.steps.length - 1];\n\n            return this.step(last, repeat);\n        }\n\n        end(fn) {\n            this.finale = fn;\n\n            return this;\n        }\n\n        rewind() {\n            this.index = 0;\n            this.playing = true;\n            this.run();\n\n            return this;\n        }\n\n        marker(marker) {\n            this.markers[marker.toString()] = this.steps.length;\n\n            return this;\n        }\n\n        goto(marker) {\n            if (typeof marker === 'string') {\n                if (this.markers[marker]) {\n                    this.index = this.markers[marker];\n                    this.run();\n                }\n            }\n\n            if (typeof marker === 'number') {\n                if (this.indexes[marker]) {\n                    this.index = this.indexes[marker];\n                    this.run();\n                }\n            }\n\n            return this;\n        }\n\n        on(key, fn) {\n            this.events[key].push(fn);\n\n            return this;\n        }\n\n        off(key, fn) {\n            if (fn) {\n                this.events[key] = this.events[key].filter((f) => f !== fn);\n            } else {\n                this.events[key] = [];\n            }\n\n            return this;\n        }\n\n        trigger(key) {\n            this.events[key].forEach((fn) => fn.call(this));\n\n            return this;\n        }\n\n        loop(loops = -1) {\n            this.loops = loops;\n\n            return this;\n        }\n\n        previous(nb = 1) {\n            let index = this._reverseIndex(this.index - nb, true);\n\n            if (index) {\n                this.index = index;\n                this.run();\n            }\n\n            return this;\n        }\n\n        next(nb = 1) {\n            let index = this._reverseIndex(this.index + nb);\n\n            if (index) {\n                this.index = index;\n                this.run();\n            }\n\n            return this;\n        }\n\n        same() {\n            this.index -= 1;\n            this.run();\n\n            return this;\n        }\n\n        run() {\n            if (!this.playing) {\n                return;\n            }\n\n            if (this.index < 0) {\n                this.index = 0;\n            }\n\n            if (this.index >= this.steps.length) {\n                this.index = 0;\n\n                if (this.loops !== -1) {\n                    this.loops--;\n                }\n\n                if (this.loops === 0) {\n                    return this.stop();\n                }\n            }\n\n            const go = () => {\n                let step = this.steps[this.index],\n                    steps = step;\n\n                if (typeof step === 'function') {\n                    this.concurrentSteps = 1;\n\n                    step.call(this, this._next.bind(this));\n                }\n\n                if (Array.isArray(steps)) {\n                    this.concurrentSteps = steps.length;\n\n                    steps.forEach((step) => {\n                        step.call(this, this._next.bind(this));\n                    });\n                }\n            };\n\n            this.trigger('before');\n\n            if (this.async) {\n                setTimeout(go);\n            } else {\n                go();\n            }\n\n            return this;\n        }\n\n        _next(doms) {\n            let domCount = 0;\n\n            let done = () => {\n                if (--this.concurrentSteps === 0) {\n                    this.index++;\n                    this.run();\n                    this.trigger('after');\n                }\n            };\n\n            if (doms) {\n                doms = Array.isArray(doms) ? doms : [ doms ];\n\n                doms.forEach((dom) => {\n                    let self = this;\n\n                    function callback () {\n                        dom.removeEventListener(self.animationEnd,  callback, false);\n                        dom.removeEventListener(self.transitionEnd, callback, false);\n\n                        if (++domCount === doms.length) {\n                            done();\n                        }\n                    }\n\n                    dom.addEventListener(this.animationEnd,  callback, false);\n                    dom.addEventListener(this.transitionEnd, callback, false);\n                });\n            } else {\n                done();\n            }\n\n            return this;\n        }\n\n        _reverseIndex(index, previous) {\n            let buffer;\n\n            for (let i = 0; i < this.indexes.length; i++) {\n                if ((previous && this.indexes[i] >= index) || (!previous && this.indexes[i] > index)) {\n                    return buffer;\n                }\n                buffer = this.indexes[i];\n            }\n\n            return 0;\n        }\n    }\n\n    function getEventName (key) {\n        const map = {\n            animation: {\n                'animation': 'animationend',\n                '-o-animation': 'oAnimationEnd',\n                '-moz-animation': 'animationend',\n                '-webkit-animation': 'webkitAnimationEnd'\n            },\n            transition: {\n                'transition': 'transitionend',\n                '-o-transition': 'oTransitionEnd',\n                '-moz-transition': 'transitionend',\n                '-webkit-transition': 'webkitTransitionEnd'\n            }\n        };\n\n        try {\n            let div = document.createElement('div');\n\n            for (let eventName in map[key]) {\n                if (typeof(div.style[eventName]) !== 'undefined') {\n                    return map[key][eventName];\n                }\n            }\n        } catch (e) {\n            return null;\n        }\n    }\n\n    return Screenplay;\n});\n"]}