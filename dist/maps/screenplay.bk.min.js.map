{"version":3,"sources":["screenplay.bk.js"],"names":["context","factory","module","exports","define","amd","Screenplay","this","getEndEventName","key","div","map","animation","-o-animation","-moz-animation","-webkit-animation","transition","-o-transition","-moz-transition","-webkit-transition","document","createElement","e","eventName","style","settings","steps","indexes","markers","index","loops","playing","animationEnd","transitionEnd","events","step","play","pause","stop","loop","before","after","timer","finale","prototype","run","trigger","toggle","call","fn","repeat","i","push","length","wait","time","next","clearTimeout","setTimeout","_repeat","last","end","rewind","marker","_marker","toString","goto","on","off","filter","f","self","forEach","undefined","previous","nb","_reverseIndex","same","concurrentSteps","_next","bind","Array","isArray","doms","domCount","done","console","log","dom","callback","removeEventListener","addEventListener","buffer"],"mappings":"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","file":"../screenplay.bk.min.js","sourcesContent":["/*!-----------------------------------------------------------------------------\n * screenplay â€” A tiny library to timeline functions\n * v0.0.1-1 - built 2016-11-19\n * Licensed under the MIT License.\n * http://screenplay.jaysalvat.com/\n * ----------------------------------------------------------------------------\n * Copyright (C) 2016 Jay Salvat\n * http://jaysalvat.com/\n * --------------------------------------------------------------------------*/\n/* global define */\n\n(function (context, factory) {\n    'use strict';\n\n    if (typeof module !== 'undefined' && module.exports) {\n        module.exports = factory();\n    } else if (typeof define === 'function' && define.amd) {\n        define([], factory);\n    } else {\n        context.Screenplay = factory();\n    }\n})(this, function () {\n    'use strict';\n\n    var Screenplay = function Screenplay(settings) {\n        if (!(this instanceof Screenplay)) {\n            return new Screenplay(settings);\n        }\n\n        this.steps = [];\n        this.indexes = [];\n        this.markers = {};\n        this.index = 0;\n        this.loops = 1;\n        this.playing = false;\n        this.animationEnd = getEndEventName('animation');\n        this.transitionEnd = getEndEventName('transition');\n        this.events = {\n            'step': [],\n            'play': [],\n            'pause': [],\n            'stop': [],\n            'loop': [],\n            'before': [],\n            'after': []\n        };\n        this.timer = null;\n        this.finale = function () {};\n\n        return this;\n    };\n\n    Screenplay.prototype = {\n        play: function play(loops) {\n            this.loops = loops ? loops : this.loops;\n            this.playing = true;\n            this.run();\n\n            return this.trigger('play');\n        },\n\n        pause: function pause() {\n            this.playing = false;\n            this.run();\n\n            return this.trigger('pause');\n        },\n\n        toggle: function toggle() {\n            return this.playing ? this.pause() : this.play();\n        },\n\n        stop: function stop() {\n            this.loops = 1;\n            this.playing = false;\n            this.finale.call(this);\n\n            return this.trigger('stop');\n        },\n\n        step: function step(fn, repeat) {\n            repeat = repeat || 1;\n\n            for (var i = 0; i < repeat; i++) {\n                this.steps.push(fn);\n                this.indexes.push(this.steps.length - 1);\n            }\n\n            return this;\n        },\n\n        wait: function wait(time) {\n            this.steps.push(function (next) {\n                clearTimeout(this.timer);\n\n                this.timer = setTimeout(function () {\n                    next();\n                }, time);\n            });\n\n            return this;\n        },\n\n        repeat: function repeat(_repeat) {\n            var last = this.steps[this.steps.length - 1];\n\n            return this.step(last, _repeat);\n        },\n\n        end: function end(fn) {\n            this.finale = fn;\n\n            return this;\n        },\n\n        rewind: function rewind() {\n            this.index = 0;\n            this.playing = true;\n            this.run();\n\n            return this;\n        },\n\n        marker: function marker(_marker) {\n            this.markers[_marker.toString()] = this.steps.length;\n\n            return this;\n        },\n\n        goto: function goto(marker) {\n            if (typeof marker === 'string') {\n                if (this.markers[marker]) {\n                    this.index = this.markers[marker];\n                    this.run();\n                }\n            }\n\n            if (typeof marker === 'number') {\n                if (this.indexes[marker]) {\n                    this.index = this.indexes[marker];\n                    this.run();\n                }\n            }\n\n            return this;\n        },\n\n        on: function on(key, fn) {\n            this.events[key].push(fn);\n\n            return this;\n        },\n\n        off: function off(key, fn) {\n            if (fn) {\n                this.events[key] = this.events[key].filter(function (f) {\n                    return f !== fn;\n                });\n            } else {\n                this.events[key] = [];\n            }\n\n            return this;\n        },\n\n        trigger: function trigger(key) {\n            var self = this;\n\n            this.events[key].forEach(function (fn) {\n                fn.call(self);\n            });\n\n            return this;\n        },\n\n        loop: function loop(loops) {\n            this.loops = loops !== undefined ? loops : -1;\n\n            return this;\n        },\n\n        previous: function previous(nb) {\n            var index = this._reverseIndex(this.index - (nb || 1), true);\n\n            if (index) {\n                this.index = index;\n                this.run();\n            }\n\n            return this;\n        },\n\n        next: function next(nb) {\n            var index = this._reverseIndex(this.index + (nb || 1));\n\n            if (index) {\n                this.index = index;\n                this.run();\n            }\n\n            return this;\n        },\n\n        same: function same() {\n            this.index -= 1;\n            this.run();\n\n            return this;\n        },\n\n        run: function run() {\n            var step;\n\n            if (!this.playing) {\n                return;\n            }\n\n            if (this.index < 0) {\n                this.index = 0;\n            }\n\n            if (this.index >= this.steps.length) {\n                this.index = 0;\n\n                if (this.loops !== -1) {\n                    this.loops--;\n                }\n\n                if (this.loops === 0) {\n                    return this.stop();\n                }\n            }\n\n            this.trigger('before');\n\n            step = this.steps[this.index];\n\n            if (typeof step === 'function') {\n                this.concurrentSteps = 1;\n\n                step.call(this, this._next.bind(this));\n            }\n\n            if (Array.isArray(step)) {\n                var steps = step;\n\n                this.concurrentSteps = steps.length;\n\n                steps.forEach(function (step) {\n                    step.call(this, this._next.bind(this));\n                });\n            }\n\n            return this;\n        },\n\n        _next: function _next(doms) {\n            var self = this,\n                domCount = 0;\n\n            var done = function done() {\n                self.concurrentSteps--;\n\n                if (self.concurrentSteps === 0) {\n                    console.log('next');\n                    self.index++;\n                    self.run();\n                    self.trigger('after');\n                }\n            };\n\n            if (doms) {\n                doms = Array.isArray(doms) ? doms : [doms];\n\n                doms.forEach(function (dom) {\n                    var callback = function callback() {\n                        dom.removeEventListener(self.animationEnd, callback);\n                        dom.removeEventListener(self.transitionEnd, callback);\n\n                        if (domCount++ === doms.length - 1) {\n                            done();\n                        }\n                    };\n\n                    dom.addEventListener(self.transitionEnd, callback, false);\n                    dom.addEventListener(self.animationEnd, callback, false);\n                });\n            } else {\n                done();\n            }\n\n            return this;\n        },\n\n        _reverseIndex: function _reverseIndex(index, previous) {\n            var buffer;\n\n            for (var i = 0; i < this.indexes.length; i++) {\n                if (previous && this.indexes[i] >= index || !previous && this.indexes[i] > index) {\n                    return buffer;\n                }\n\n                buffer = this.indexes[i];\n            }\n\n            return 0;\n        }\n    };\n\n    function getEndEventName(key) {\n        var div,\n            map = {\n            animation: {\n                'animation': 'animationend',\n                '-o-animation': 'oAnimationEnd',\n                '-moz-animation': 'animationend',\n                '-webkit-animation': 'webkitAnimationEnd'\n            },\n            transition: {\n                'transition': 'transitionend',\n                '-o-transition': 'oTransitionEnd',\n                '-moz-transition': 'transitionend',\n                '-webkit-transition': 'webkitTransitionEnd'\n            }\n        };\n\n        try {\n            div = document.createElement('div');\n        } catch (e) {\n            return null;\n        }\n\n        for (var eventName in map[key]) {\n            if (typeof div.style[eventName] !== 'undefined') {\n                return map[key][eventName];\n            }\n        }\n\n        return null;\n    }\n\n    return Screenplay;\n});\n//# sourceMappingURL=maps/screenplay.bk.js.map\n"]}