{"version":3,"sources":["maps/maps/screenplay.working.js"],"names":["getEventName","key","map","animation","-o-animation","-moz-animation","-webkit-animation","transition","-o-transition","-moz-transition","-webkit-transition","div","document","createElement","eventName","style","e","Screenplay","settings","arguments","length","undefined","_classCallCheck","this","_settings$async","async","steps","waits","index","loops","indexes","markers","playing","started","animationEnd","transitionEnd","timer","events","step","play","stop","loop","pause","before","after","finale","next","_run","_trigger","call","fn","repeat","i","push","time","marker","toString","nb","filter","f","_this","forEach","_this2","go","concurrentSteps","_next","bind","Array","isArray","setTimeout","elements","_this3","elementCount","done","goNext","element","callback","removeEventListener","self","HTMLElement","addEventListener","tagName","then"],"mappings":"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","file":"../screenplay.working.min.js","sourcesContent":["'use strict';\n\nclass Screenplay {\n    constructor (settings = {}) {\n        let {\n            async = true\n        } = settings;\n\n        this.async = async;\n        this.steps = [];\n        this.waits = [];\n        this.index = 0;\n        this.loops = 1;\n        this.indexes = [];\n        this.markers = {};\n        this.playing = false;\n        this.started = false;\n        this.animationEnd = getEventName('animation');\n        this.transitionEnd = getEventName('transition');\n        this.timer = null;\n        this.events = {\n            'step': [],\n            'play': [],\n            'stop': [],\n            'loop': [],\n            'pause': [],\n            'before': [],\n            'after': []\n        };\n        this.finale = () => {};\n    }\n\n    play(loops = this.loops) {\n        this.loops = loops;\n\n        if (!this.playing) {\n            this.playing = true;\n\n            if (this.started) {\n                this.next();\n            } else {\n                this._run();\n            }\n\n            this._trigger('play');\n        }\n\n        return this;\n    }\n\n    pause() {\n        if (this.playing) {\n            this.playing = false;\n            this._trigger('pause');\n        }\n\n        return this;\n    }\n\n    toggle() {\n        return this.playing ? this.pause() : this.play();\n    }\n\n    stop() {\n        this.loops = 1;\n        this.playing = false;\n        this.finale.call(this);\n\n        return this._trigger('stop');\n    }\n\n    step(fn, repeat = 1) {\n        for (let i = 0; i < repeat; i++) {\n            this.steps.push(fn);\n        }\n\n        return this;\n    }\n\n    wait(time) {\n        this.waits[this.steps.length - 1] = time;\n\n        return this;\n    }\n\n    end(fn) {\n        this.finale = fn;\n\n        return this;\n    }\n\n    rewind() {\n        this.index = 0;\n\n        return this._run();\n    }\n\n    marker(marker) {\n        this.markers[marker.toString()] = this.steps.length;\n\n        return this;\n    }\n\n    goto(marker) {\n        if (typeof marker === 'string') {\n            if (this.markers[marker]) {\n                this.index = this.markers[marker];\n            }\n        }\n\n        if (typeof marker === 'number') {\n            if (this.steps[marker]) {\n                this.index = this.steps[marker];\n            }\n        }\n\n        return this._run();\n    }\n\n    loop(loops = -1) {\n        this.loops = loops;\n\n        return this;\n    }\n\n    previous(nb = 1) {\n        this.index = this.index - nb;\n\n        return this._run();\n    }\n\n    next(nb = 1) {\n        this.index = this.index + nb;\n\n        return this._run();\n    }\n\n    same() {\n        return this._run();\n    }\n\n    on(key, fn) {\n        this.events[key].push(fn);\n\n        return this;\n    }\n\n    off(key, fn) {\n        if (fn) {\n            this.events[key] = this.events[key].filter((f) => f !== fn);\n        } else {\n            this.events[key] = [];\n        }\n\n        return this;\n    }\n\n    _trigger(key) {\n        this.events[key].forEach((fn) => fn.call(this));\n\n        return this;\n    }\n    _run() {\n        if (this.index < 0) {\n            this.index = 0;\n            return;\n        }\n\n        if (this.index >= this.steps.length) {\n            this.index = 0;\n\n            if (this.loops !== -1) {\n                this.loops--;\n            }\n\n            if (this.loops === 0) {\n                return this.stop();\n            }\n        }\n\n        const go = () => {\n            if (!this.started) {\n                this.started = true;\n            }\n\n            let step = this.steps[this.index],\n                steps = step;\n\n            if (typeof step === 'function') {\n                this.concurrentSteps = 1;\n\n                step.call(this, this._next.bind(this));\n            }\n\n            if (Array.isArray(steps)) {\n                this.concurrentSteps = steps.length;\n\n                steps.forEach((step) => {\n                    step.call(this, this._next.bind(this));\n                });\n            }\n        };\n\n        this._trigger('before');\n\n        if (this.async) {\n            setTimeout(go);\n        } else {\n            go();\n        }\n\n        return this;\n    }\n\n    _next(elements) {\n        let elementCount = 0;\n\n        let done = () => {\n            let goNext = () => {\n                this.index++;\n                this._run();\n                this._trigger('after');\n            };\n\n            if (--this.concurrentSteps === 0) {\n                if (this.playing) {\n                    if (this.waits[this.index]) {\n                        setTimeout(function () {\n                            goNext();\n                        }, this.waits[this.index]);\n                    } else {\n                        goNext();\n                    }\n                }\n            }\n        };\n\n        if (elements) {\n            elements = Array.isArray(elements) ? elements : [ elements ];\n\n            elements.forEach((element) => {\n                let self = this;\n\n                function callback () {\n                    element.removeEventListener(self.animationEnd,  callback, false);\n                    element.removeEventListener(self.transitionEnd, callback, false);\n                    element.removeEventListener(\"ended\", callback, false);\n\n                    if (++elementCount === elements.length) {\n                        done();\n                    }\n                }\n\n                if (typeof HTMLElement !== 'undefined' && element instanceof HTMLElement) {\n                    element.addEventListener(this.animationEnd,  callback, false);\n                    element.addEventListener(this.transitionEnd, callback, false);\n\n                    if (element.tagName === 'AUDIO' || element.tagName === 'VIDEO') {\n                        element.addEventListener(\"ended\", callback, false);\n                    }\n                }\n\n                if (typeof element.then === 'function') {\n                    element.then(done, done);\n                }\n            });\n        } else {\n            done();\n        }\n\n        return this;\n    }\n}\n\nfunction getEventName (key) {\n    const map = {\n        animation: {\n            'animation': 'animationend',\n            '-o-animation': 'oAnimationEnd',\n            '-moz-animation': 'animationend',\n            '-webkit-animation': 'webkitAnimationEnd'\n        },\n        transition: {\n            'transition': 'transitionend',\n            '-o-transition': 'oTransitionEnd',\n            '-moz-transition': 'transitionend',\n            '-webkit-transition': 'webkitTransitionEnd'\n        }\n    };\n\n    try {\n        let div = document.createElement('div');\n\n        for (let eventName in map[key]) {\n            if (typeof(div.style[eventName]) !== 'undefined') {\n                return map[key][eventName];\n            }\n        }\n    } catch (e) {\n        return null;\n    }\n}\n\nexport default Screenplay;\n"]}