{"version":3,"sources":["maps/screenplay.js"],"names":["Screenplay","settings","async","steps","index","loops","indexes","markers","playing","animationEnd","getEventName","transitionEnd","timer","events","finale","run","trigger","pause","play","call","fn","repeat","i","push","length","time","next","clearTimeout","setTimeout","last","step","marker","toString","key","filter","f","forEach","nb","_reverseIndex","stop","go","concurrentSteps","_next","bind","Array","isArray","elements","elementCount","done","element","self","callback","removeEventListener","HTMLElement","addEventListener","tagName","then","previous","buffer","map","animation","transition","div","document","createElement","eventName","style","e"],"mappings":"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","file":"../screenplay.js","sourcesContent":["'use strict';\n\nclass Screenplay {\n    constructor (settings = {}) {\n        let {\n            async = true\n        } = settings;\n\n        this.async = async;\n        this.steps = [];\n        this.index = 0;\n        this.loops = 1;\n        this.indexes = [];\n        this.markers = {};\n        this.playing = false;\n        this.animationEnd = getEventName('animation');\n        this.transitionEnd = getEventName('transition');\n        this.timer = null;\n        this.events = {\n            'step': [],\n            'play': [],\n            'stop': [],\n            'loop': [],\n            'pause': [],\n            'before': [],\n            'after': []\n        };\n        this.finale = () => {};\n    }\n\n    play(loops = this.loops) {\n        this.loops = loops;\n        this.playing = true;\n        this.run();\n\n        return this.trigger('play');\n    }\n\n    pause() {\n        this.playing = false;\n        this.run();\n\n        return this.trigger('pause');\n    }\n\n    toggle() {\n        return this.playing ? this.pause() : this.play();\n    }\n\n    stop() {\n        this.loops = 1;\n        this.playing = false;\n        this.finale.call(this);\n\n        return this.trigger('stop');\n    }\n\n    step(fn, repeat = 1) {\n        for (let i = 0; i < repeat; i++) {\n            this.steps.push(fn);\n            this.indexes.push(this.steps.length - 1);\n        }\n\n        return this;\n    }\n\n    wait(time) {\n        this.steps.push(function (next) {\n            clearTimeout(this.timer);\n\n            this.timer = setTimeout(function () {\n                next();\n            }, time);\n        });\n\n        return this;\n    }\n\n    repeat(repeat) {\n        let last = this.steps[this.steps.length - 1];\n\n        return this.step(last, repeat);\n    }\n\n    end(fn) {\n        this.finale = fn;\n\n        return this;\n    }\n\n    rewind() {\n        this.index = 0;\n        this.playing = true;\n        this.run();\n\n        return this;\n    }\n\n    marker(marker) {\n        this.markers[marker.toString()] = this.steps.length;\n\n        return this;\n    }\n\n    goto(marker) {\n        if (typeof marker === 'string') {\n            if (this.markers[marker]) {\n                this.index = this.markers[marker];\n                this.run();\n            }\n        }\n\n        if (typeof marker === 'number') {\n            if (this.indexes[marker]) {\n                this.index = this.indexes[marker];\n                this.run();\n            }\n        }\n\n        return this;\n    }\n\n    on(key, fn) {\n        this.events[key].push(fn);\n\n        return this;\n    }\n\n    off(key, fn) {\n        if (fn) {\n            this.events[key] = this.events[key].filter((f) => f !== fn);\n        } else {\n            this.events[key] = [];\n        }\n\n        return this;\n    }\n\n    trigger(key) {\n        this.events[key].forEach((fn) => fn.call(this));\n\n        return this;\n    }\n\n    loop(loops = -1) {\n        this.loops = loops;\n\n        return this;\n    }\n\n    previous(nb = 1) {\n        let index = this._reverseIndex(this.index - nb, true);\n\n        if (index) {\n            this.index = index;\n            this.run();\n        }\n\n        return this;\n    }\n\n    next(nb = 1) {\n        let index = this._reverseIndex(this.index + nb);\n\n        if (index) {\n            this.index = index;\n            this.run();\n        }\n\n        return this;\n    }\n\n    same() {\n        this.index -= 1;\n        this.run();\n\n        return this;\n    }\n\n    run() {\n        if (!this.playing) {\n            return;\n        }\n\n        if (this.index < 0) {\n            this.index = 0;\n        }\n\n        if (this.index >= this.steps.length) {\n            this.index = 0;\n\n            if (this.loops !== -1) {\n                this.loops--;\n            }\n\n            if (this.loops === 0) {\n                return this.stop();\n            }\n        }\n\n        const go = () => {\n            let step = this.steps[this.index],\n                steps = step;\n\n            if (typeof step === 'function') {\n                this.concurrentSteps = 1;\n\n                step.call(this, this._next.bind(this));\n            }\n\n            if (Array.isArray(steps)) {\n                this.concurrentSteps = steps.length;\n\n                steps.forEach((step) => {\n                    step.call(this, this._next.bind(this));\n                });\n            }\n        };\n\n        this.trigger('before');\n\n        if (this.async) {\n            setTimeout(go);\n        } else {\n            go();\n        }\n\n        return this;\n    }\n\n    _next(elements) {\n        let elementCount = 0;\n\n        let done = () => {\n            if (--this.concurrentSteps === 0) {\n                this.index++;\n                this.run();\n                this.trigger('after');\n            }\n        };\n\n        if (elements) {\n            elements = Array.isArray(elements) ? elements : [ elements ];\n\n            elements.forEach((element) => {\n                let self = this;\n\n                function callback () {\n                    element.removeEventListener(self.animationEnd,  callback, false);\n                    element.removeEventListener(self.transitionEnd, callback, false);\n                    element.removeEventListener(\"ended\", callback, false);\n\n                    if (++elementCount === elements.length) {\n                        done();\n                    }\n                }\n\n                if (typeof HTMLElement !== 'undefined' && element instanceof HTMLElement) {\n                    element.addEventListener(this.animationEnd,  callback, false);\n                    element.addEventListener(this.transitionEnd, callback, false);\n\n                    if (element.tagName === 'AUDIO' || element.tagName === 'VIDEO') {\n                        element.addEventListener(\"ended\", callback, false);\n                    }\n                }\n\n                if (typeof element.then === 'function') {\n                    element.then(done, done);\n                }\n            });\n        } else {\n            done();\n        }\n\n        return this;\n    }\n\n    _reverseIndex(index, previous) {\n        let buffer;\n\n        for (let i = 0; i < this.indexes.length; i++) {\n            if ((previous && this.indexes[i] >= index) || (!previous && this.indexes[i] > index)) {\n                return buffer;\n            }\n            buffer = this.indexes[i];\n        }\n\n        return 0;\n    }\n}\n\nfunction getEventName (key) {\n    const map = {\n        animation: {\n            'animation': 'animationend',\n            '-o-animation': 'oAnimationEnd',\n            '-moz-animation': 'animationend',\n            '-webkit-animation': 'webkitAnimationEnd'\n        },\n        transition: {\n            'transition': 'transitionend',\n            '-o-transition': 'oTransitionEnd',\n            '-moz-transition': 'transitionend',\n            '-webkit-transition': 'webkitTransitionEnd'\n        }\n    };\n\n    try {\n        let div = document.createElement('div');\n\n        for (let eventName in map[key]) {\n            if (typeof(div.style[eventName]) !== 'undefined') {\n                return map[key][eventName];\n            }\n        }\n    } catch (e) {\n        return null;\n    }\n}\n\nexport default Screenplay;\n"]}