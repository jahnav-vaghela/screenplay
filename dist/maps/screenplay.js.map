{"version":3,"sources":["maps/screenplay.js"],"names":["Screenplay","settings","async","direction","loops","loopBackward","steps","waits","index","loopBuffer","dir","inited","playing","timer1","timer2","markers","animationEnd","getEventName","transitionEnd","events","finale","length","_trigger","_run","next","_break","pause","play","call","fn","nb","undefined","repeat","i","push","time","marker","toString","key","filter","f","forEach","started","clearTimeout","stop","go","step","concurrentSteps","_next","bind","Array","isArray","setTimeout","elements","elementCount","done","element","self","callback","removeEventListener","HTMLElement","addEventListener","tagName","then","map","animation","transition","div","document","createElement","eventName","style","e"],"mappings":"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","file":"../screenplay.js","sourcesContent":["'use strict';\n\nclass Screenplay {\n    constructor (settings = {}) {\n        let {\n            async = false,\n            direction = 1,\n            loops = 1,\n            loopBackward = false,\n        } = settings;\n\n        this.steps = [];\n        this.waits = [];\n        this.async = async;\n        this.index = 0;\n        this.loops = loops;\n        this.loopBackward = loopBackward;\n        this.loopBuffer = loops;\n        this.dir = direction;\n        this.inited = false;\n        this.playing = false;\n        this.timer1 = null;\n        this.timer2 = null;\n        this.markers = {};\n        this.animationEnd = getEventName('animation');\n        this.transitionEnd = getEventName('transition');\n        this.events = {\n            'init': [],\n            'play': [],\n            'stop': [],\n            'start': [],\n            'loop': [],\n            'pause': [],\n            'before': [],\n            'after': []\n        };\n        this.finale = () => {};\n    }\n\n    init() {\n        this.inited = true;\n        this.playing = false;\n\n        if (this.dir === -1) {\n            this.index = this.steps.length - 1;\n        } else {\n            this.index = 0;\n        }\n\n        this._trigger('init');\n\n        this._run();\n\n        return this;\n    }\n\n    play(loops = this.loops) {\n        this.loops = loops;\n        this.loopBuffer = loops;\n\n        if (!this.playing) {\n            this.playing = true;\n\n            this._trigger('play');\n\n            if (this.inited) {\n                this.next();\n            } else {\n                this.inited = true;\n\n                if (this.dir === -1) {\n                    this.index = this.steps.length - 1;\n                } else {\n                    this.index = 0;\n                }\n\n                this._run();\n            }\n        }\n\n        return this;\n    }\n\n    pause() {\n        if (this.playing) {\n            this.playing = false;\n\n            this._break();\n            this._trigger('pause');\n        }\n\n        return this;\n    }\n\n    toggle() {\n        return this.playing ? this.pause() : this.play();\n    }\n\n    stop() {\n        if (this.inited) {\n            this.playing = false;\n            this.inited = false;\n\n            this._break();\n            this._trigger('stop');\n\n            this.finale.call(this);\n        }\n\n        return this;\n    }\n\n    done(fn) {\n        this.finale = fn;\n\n        return this;\n    }\n\n    previous(nb = 1) {\n        if (this.inited) {\n            this.index = this.index - (nb * this.dir);\n            this._run();\n        }\n\n        return this;\n    }\n\n    next(nb = 1) {\n        if (this.inited) {\n            this.index = this.index + (nb * this.dir);\n            this._run();\n        }\n\n        return this;\n    }\n\n    same() {\n        this._run();\n\n        return this;\n    }\n\n    rewind() {\n        this.index = (this.dir === -1) ? this.steps.length - 1 : 0;\n\n        return this._run();\n    }\n\n    loop(loops = -1, loopBackward = this.loopBackward) {\n        this.loops = loops;\n        this.loopBackward = loopBackward;\n        this.loopBuffer = loops;\n\n        return this;\n    }\n\n    index(index) {\n        if (index === undefined) {\n            return this.index;\n        }\n        this.index = index;\n\n        return this;\n    }\n\n    direction(direction) {\n        if (direction === undefined) {\n            return this.dir;\n        }\n        this.dir = direction;\n\n        return this;\n    }\n\n    reverse() {\n        return this.direction(this.dir * -1);\n    }\n\n    step(fn, repeat = 1) {\n        for (let i = 0; i < repeat; i++) {\n            this.steps.push(fn);\n        }\n\n        return this;\n    }\n\n    wait(time) {\n        this.waits[this.steps.length - 1] = time;\n\n        if (time) {\n            this.async = true;\n        }\n\n        return this;\n    }\n\n    marker(marker) {\n        this.markers[marker.toString()] = this.steps.length;\n\n        return this;\n    }\n\n    goto(marker) {\n        if (typeof marker === 'string') {\n            if (this.markers[marker]) {\n                this.index = this.markers[marker];\n            }\n        }\n\n        if (typeof marker === 'number') {\n            if (this.steps[marker]) {\n                this.index = this.steps[marker];\n            }\n        }\n\n        return this._run();\n    }\n\n    on(key, fn) {\n        this.events[key].push(fn);\n\n        return this;\n    }\n\n    off(key, fn) {\n        if (fn) {\n            this.events[key] = this.events[key].filter((f) => f !== fn);\n        } else {\n            this.events[key] = [];\n        }\n\n        return this;\n    }\n\n    _trigger(key) {\n        this.events[key].forEach((fn) => fn.call(this));\n\n        return this;\n    }\n\n    _break() {\n        if (this.started) {\n            this.started = false;\n            this._trigger('after');\n        }\n\n        clearTimeout(this.timer1);\n        clearTimeout(this.timer2);\n    }\n\n    _run() {\n        if (this.index < 0) {\n            if (this.loops !== -1) {\n                if (this.dir === -1 || (this.dir === 1 && this.loopBackward)) {\n                    this.index = this.steps.length - 1;\n                    this.loops = this.loops + this.dir;\n                } else {\n                    return this.stop();\n                }\n            } else {\n                this.index = this.steps.length - 1;\n            }\n\n            if (this.loops === 0 || this.loops > this.loopBuffer) {\n                return this.stop();\n            } else {\n                this._trigger('loop');\n            }\n        }\n\n        if (this.index >= this.steps.length) {\n            if (this.loops !== -1) {\n                if (this.dir === 1 || (this.dir === -1 && this.loopBackward)) {\n                    this.index = 0;\n                    this.loops = this.loops - this.dir;\n                } else {\n                    return this.stop();\n                }\n            } else {\n                this.index = 0;\n            }\n\n            if (this.loops === 0 || this.loops > this.loopBuffer) {\n                return this.stop();\n            } else {\n                this._trigger('loop');\n            }\n        }\n\n        let go = () => {\n            let step = this.steps[this.index],\n                steps = step;\n\n            this.started = true;\n            this._trigger('before');\n\n            if (typeof step === 'function') {\n                this.concurrentSteps = 1;\n\n                step.call(this, this._next.bind(this));\n            }\n\n            if (Array.isArray(steps)) {\n                this.concurrentSteps = steps.length;\n\n                steps.forEach((step) => {\n                    step.call(this, this._next.bind(this));\n                });\n            }\n        };\n\n        if (this.async) {\n            clearTimeout(this.timer1);\n\n            this.timer1 = setTimeout(go);\n        } else {\n            go();\n        }\n\n        return this;\n    }\n\n    _next(elements) {\n        let elementCount = 0;\n\n        if (!this.playing) {\n            this._trigger('after');\n            return;\n        }\n\n        let go = () => {\n            if (this.started) {\n                this.started = false;\n                this._trigger('after');\n            }\n\n            this.index = this.index + this.dir;\n            this._run();\n        };\n\n        let done = () => {\n            if (--this.concurrentSteps <= 0) {\n                if (this.async) {\n                    clearTimeout(this.timer2);\n\n                    this.timer2 = setTimeout(go, this.waits[this.index]);\n                } else {\n                    go();\n                }\n            }\n        };\n\n        if (elements) {\n            elements = Array.isArray(elements) ? elements : [ elements ];\n\n            elements.forEach((element) => {\n                let self = this;\n\n                function callback () {\n                    element.removeEventListener(self.animationEnd,  callback, false);\n                    element.removeEventListener(self.transitionEnd, callback, false);\n                    element.removeEventListener(\"ended\", callback, false);\n\n                    if (++elementCount === elements.length) {\n                        done();\n                    }\n                }\n\n                if (typeof HTMLElement !== 'undefined' && element instanceof HTMLElement) {\n                    element.addEventListener(this.animationEnd,  callback, false);\n                    element.addEventListener(this.transitionEnd, callback, false);\n\n                    if (element.tagName === 'AUDIO' || element.tagName === 'VIDEO') {\n                        element.addEventListener(\"ended\", callback, false);\n                    }\n                }\n\n                if (typeof element.then === 'function') {\n                    element.then(done, done);\n                }\n            });\n        } else {\n            done();\n        }\n\n        return this;\n    }\n}\n\nfunction getEventName (key) {\n    const map = {\n        animation: {\n            'animation': 'animationend',\n            '-o-animation': 'oAnimationEnd',\n            '-moz-animation': 'animationend',\n            '-webkit-animation': 'webkitAnimationEnd'\n        },\n        transition: {\n            'transition': 'transitionend',\n            '-o-transition': 'oTransitionEnd',\n            '-moz-transition': 'transitionend',\n            '-webkit-transition': 'webkitTransitionEnd'\n        }\n    };\n\n    try {\n        let div = document.createElement('div');\n\n        for (let eventName in map[key]) {\n            if (typeof(div.style[eventName]) !== 'undefined') {\n                return map[key][eventName];\n            }\n        }\n    } catch (e) {\n        return null;\n    }\n}\n\nexport default Screenplay;\n"]}