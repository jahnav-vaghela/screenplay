{"version":3,"sources":["maps/screenplay.js"],"names":["Screenplay","settings","async","direction","loops","loopBackward","steps","waits","index","loopBuffer","dir","indexes","markers","playing","started","running","animationEnd","getEventName","transitionEnd","timer","events","finale","call","_trigger","length","_run","pause","play","nb","fn","repeat","i","push","time","undefined","marker","toString","key","filter","f","forEach","stop","go","step","concurrentSteps","_next","bind","Array","isArray","setTimeout","elements","elementCount","done","clearTimeout","element","self","callback","removeEventListener","HTMLElement","addEventListener","tagName","then","map","animation","transition","div","document","createElement","eventName","style","e"],"mappings":"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","file":"../screenplay.js","sourcesContent":["'use strict';\n\nclass Screenplay {\n    constructor (settings = {}) {\n        let {\n            async = false,\n            direction = 1,\n            loops = 1,\n            loopBackward = false,\n        } = settings;\n\n        this.steps = [];\n        this.waits = [];\n        this.index = 0;\n        this.loops = loops;\n        this.async = async;\n        this.loopBackward = loopBackward;\n        this.loopBuffer = loops;\n        this.dir = direction;\n        this.indexes = [];\n        this.markers = {};\n        this.playing = false;\n        this.started = false;\n        this.running = false;\n        this.animationEnd = getEventName('animation');\n        this.transitionEnd = getEventName('transition');\n        this.timer = null;\n        this.events = {\n            'step': [],\n            'play': [],\n            'stop': [],\n            'start': [],\n            'loop': [],\n            'pause': [],\n            'before': [],\n            'after': []\n        };\n        this.finale = () => {};\n    }\n\n    stop() {\n        if (this.started) {\n            this.started = false;\n            this.running = false;\n            this.playing = false;\n            this.finale.call(this);\n            this._trigger('stop');\n        }\n\n         return this;\n    }\n\n    play(loops = this.loops) {\n        this.loops = loops;\n        this.loopBuffer = loops;\n\n        if (!this.started) {\n            if (this.dir === -1) {\n                this.index = this.steps.length - 1;\n            }\n        }\n\n        if (!this.playing) {\n            this.playing = true;\n            this.started = true;\n            this.running = false;\n\n            this._run();\n\n            this._trigger('play');\n        }\n\n        return this;\n    }\n\n    pause() {\n        if (this.playing) {\n            this.playing = false;\n            this._trigger('pause');\n        }\n\n        return this;\n    }\n\n    toggle() {\n        return this.playing ? this.pause() : this.play();\n    }\n\n    previous(nb = 1) {\n        if (this.started) {\n            this.index = this.index - ((nb + 1) * this.dir);\n            this._run();\n        }\n\n        return this;\n    }\n\n    next(nb = 1) {\n        if (this.started) {\n            this.index = this.index + ((nb - 1) * this.dir);\n            this._run();\n        }\n\n        return this;\n    }\n\n    same() {\n        this.index = this.index - (1 * this.dir);\n        this._run();\n\n        return this;\n    }\n\n    rewind() {\n        this.index = (this.dir === -1) ? this.steps.length - 1 : 0;\n\n        return this._run();\n    }\n\n    step(fn, repeat = 1) {\n        for (let i = 0; i < repeat; i++) {\n            this.steps.push(fn);\n        }\n\n        return this;\n    }\n\n    wait(time) {\n        this.waits[this.steps.length - 1] = time;\n\n        return this;\n    }\n\n    index(index) {\n        if (index === undefined) {\n            return this.index;\n        }\n        this.index = index;\n\n        return this;\n    }\n\n    direction(direction) {\n        if (direction === undefined) {\n            return this.dir;\n        }\n        this.dir = direction;\n\n        return this;\n    }\n\n    reverse() {\n        return this.direction(this.dir * -1);\n    }\n\n    done(fn) {\n        this.finale = fn;\n\n        return this;\n    }\n\n    loop(loops = -1, loopBackward = this.loopBackward) {\n        this.loops = loops;\n        this.loopBackward = loopBackward;\n        this.loopBuffer = loops;\n\n        return this;\n    }\n\n    marker(marker) {\n        this.markers[marker.toString()] = this.steps.length;\n\n        return this;\n    }\n\n    goto(marker) {\n        if (typeof marker === 'string') {\n            if (this.markers[marker]) {\n                this.index = this.markers[marker];\n            }\n        }\n\n        if (typeof marker === 'number') {\n            if (this.steps[marker]) {\n                this.index = this.steps[marker];\n            }\n        }\n\n        return this._run();\n    }\n\n    on(key, fn) {\n        this.events[key].push(fn);\n\n        return this;\n    }\n\n    off(key, fn) {\n        if (fn) {\n            this.events[key] = this.events[key].filter((f) => f !== fn);\n        } else {\n            this.events[key] = [];\n        }\n\n        return this;\n    }\n\n    _trigger(key) {\n        this.events[key].forEach((fn) => fn.call(this));\n\n        return this;\n    }\n\n    _run() {\n        if (!this.started) {\n            return;\n        }\n\n        this.running = true;\n\n        if (this.index < 0) {\n            if (this.loops !== -1) {\n                // if (this.dir === -1 || (this.dir === 1 && this.loopBackward)) {\n                if (this.dir === -1 || (this.dir === 1 && this.loopBackward)) {\n                    this.index = this.steps.length - 1;\n                    this.loops = this.loops + this.dir;\n                } else {\n                    return this.stop();\n                }\n            }\n\n            if (this.loops === 0 || this.loops > this.loopBuffer) {\n                return this.stop();\n            }\n        }\n\n        if (this.index >= this.steps.length) {\n            if (this.loops !== -1) {\n                if (this.dir === 1 || (this.dir === -1 && this.loopBackward)) {\n                    this.index = 0;\n                    this.loops = this.loops - this.dir;\n                } else {\n                    return this.stop();\n                }\n            }\n\n            if (this.loops === 0 || this.loops > this.loopBuffer) {\n                return this.stop();\n            }\n        }\n\n        let go = () => {\n            let step = this.steps[this.index],\n                steps = step;\n\n            this._trigger('before');\n\n            if (typeof step === 'function') {\n                this.concurrentSteps = 1;\n\n                step.call(this, this._next.bind(this));\n            }\n\n            if (Array.isArray(steps)) {\n                this.concurrentSteps = steps.length;\n\n                steps.forEach((step) => {\n                    step.call(this, this._next.bind(this));\n                });\n            }\n\n            this.index = this.index + this.dir;\n        };\n\n        if (this.async) {\n            setTimeout(go);\n        } else {\n            go();\n        }\n\n        return this;\n    }\n\n    _next(elements) {\n        let elementCount = 0;\n\n        let done = () => {\n            if (--this.concurrentSteps <= 0) {\n                clearTimeout(this.timer);\n\n                this.timer = setTimeout(() => {\n                    if (!this.playing) {\n                        return;\n                    }\n                    this._run();\n                    this._trigger('after');\n                }, this.waits[this.index]);\n            }\n        };\n\n        if (elements) {\n            elements = Array.isArray(elements) ? elements : [ elements ];\n\n            elements.forEach((element) => {\n                let self = this;\n\n                function callback () {\n                    element.removeEventListener(self.animationEnd,  callback, false);\n                    element.removeEventListener(self.transitionEnd, callback, false);\n                    element.removeEventListener(\"ended\", callback, false);\n\n                    if (++elementCount === elements.length) {\n                        done();\n                    }\n                }\n\n                if (typeof HTMLElement !== 'undefined' && element instanceof HTMLElement) {\n                    element.addEventListener(this.animationEnd,  callback, false);\n                    element.addEventListener(this.transitionEnd, callback, false);\n\n                    if (element.tagName === 'AUDIO' || element.tagName === 'VIDEO') {\n                        element.addEventListener(\"ended\", callback, false);\n                    }\n                }\n\n                if (typeof element.then === 'function') {\n                    element.then(done, done);\n                }\n            });\n        } else {\n            done();\n        }\n\n        return this;\n    }\n}\n\nfunction getEventName (key) {\n    const map = {\n        animation: {\n            'animation': 'animationend',\n            '-o-animation': 'oAnimationEnd',\n            '-moz-animation': 'animationend',\n            '-webkit-animation': 'webkitAnimationEnd'\n        },\n        transition: {\n            'transition': 'transitionend',\n            '-o-transition': 'oTransitionEnd',\n            '-moz-transition': 'transitionend',\n            '-webkit-transition': 'webkitTransitionEnd'\n        }\n    };\n\n    try {\n        let div = document.createElement('div');\n\n        for (let eventName in map[key]) {\n            if (typeof(div.style[eventName]) !== 'undefined') {\n                return map[key][eventName];\n            }\n        }\n    } catch (e) {\n        return null;\n    }\n}\n\nexport default Screenplay;\n"]}