/*!-----------------------------------------------------------------------------
 * screenplay â€” A tiny Javascript library to timeline functions
 * v0.0.1 - built 2016-11-21
 * Licensed under the MIT License.
 * http://screenplay.jaysalvat.com/
 * ----------------------------------------------------------------------------
 * Copyright (C) 2016 Jay Salvat
 * http://jaysalvat.com/
 * --------------------------------------------------------------------------*/
!function(t,e){if("function"==typeof define&&define.amd)define(["module","exports"],e);else if("undefined"!=typeof exports)e(module,exports);else{var n={exports:{}};e(n,n.exports),t.Screenplay=n.exports}}(this,function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t){var e={animation:{animation:"animationend","-o-animation":"oAnimationEnd","-moz-animation":"animationend","-webkit-animation":"webkitAnimationEnd"},transition:{transition:"transitionend","-o-transition":"oTransitionEnd","-moz-transition":"transitionend","-webkit-transition":"webkitTransitionEnd"}};try{var n=document.createElement("div");for(var i in e[t])if("undefined"!=typeof n.style[i])return e[t][i]}catch(t){return null}}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,t);var s=e.async,r=void 0===s||s;this.async=r,this.steps=[],this.index=0,this.loops=1,this.indexes=[],this.markers={},this.playing=!1,this.animationEnd=i("animation"),this.transitionEnd=i("transition"),this.timer=null,this.events={step:[],play:[],stop:[],loop:[],pause:[],before:[],after:[]},this.finale=function(){}}return s(t,[{key:"play",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.loops;return this.loops=t,this.playing=!0,this.run(),this.trigger("play")}},{key:"pause",value:function(){return this.playing=!1,this.run(),this.trigger("pause")}},{key:"toggle",value:function(){return this.playing?this.pause():this.play()}},{key:"stop",value:function(){return this.loops=1,this.playing=!1,this.finale.call(this),this.trigger("stop")}},{key:"step",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=0;n<e;n++)this.steps.push(t),this.indexes.push(this.steps.length-1);return this}},{key:"wait",value:function(t){return this.steps.push(function(e){clearTimeout(this.timer),this.timer=setTimeout(function(){e()},t)}),this}},{key:"repeat",value:function(t){var e=this.steps[this.steps.length-1];return this.step(e,t)}},{key:"end",value:function(t){return this.finale=t,this}},{key:"rewind",value:function(){return this.index=0,this.playing=!0,this.run(),this}},{key:"marker",value:function(t){return this.markers[t.toString()]=this.steps.length,this}},{key:"goto",value:function(t){return"string"==typeof t&&this.markers[t]&&(this.index=this.markers[t],this.run()),"number"==typeof t&&this.indexes[t]&&(this.index=this.indexes[t],this.run()),this}},{key:"on",value:function(t,e){return this.events[t].push(e),this}},{key:"off",value:function(t,e){return e?this.events[t]=this.events[t].filter(function(t){return t!==e}):this.events[t]=[],this}},{key:"trigger",value:function(t){var e=this;return this.events[t].forEach(function(t){return t.call(e)}),this}},{key:"loop",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;return this.loops=t,this}},{key:"previous",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=this._reverseIndex(this.index-t,!0);return e&&(this.index=e,this.run()),this}},{key:"next",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=this._reverseIndex(this.index+t);return e&&(this.index=e,this.run()),this}},{key:"same",value:function(){return this.index-=1,this.run(),this}},{key:"run",value:function(){var t=this;if(this.playing){if(this.index<0&&(this.index=0),this.index>=this.steps.length&&(this.index=0,this.loops!==-1&&this.loops--,0===this.loops))return this.stop();var e=function(){var e=t.steps[t.index],n=e;"function"==typeof e&&(t.concurrentSteps=1,e.call(t,t._next.bind(t))),Array.isArray(n)&&(t.concurrentSteps=n.length,n.forEach(function(e){e.call(t,t._next.bind(t))}))};return this.trigger("before"),this.async?setTimeout(e):e(),this}}},{key:"_next",value:function(t){var e=this,n=0,i=function(){0===--e.concurrentSteps&&(e.index++,e.run(),e.trigger("after"))};return t?(t=Array.isArray(t)?t:[t],t.forEach(function(s){function r(){s.removeEventListener(o.animationEnd,r,!1),s.removeEventListener(o.transitionEnd,r,!1),s.removeEventListener("ended",r,!1),++n===t.length&&i()}var o=e;"undefined"!=typeof HTMLElement&&s instanceof HTMLElement&&(s.addEventListener(e.animationEnd,r,!1),s.addEventListener(e.transitionEnd,r,!1),"AUDIO"!==s.tagName&&"VIDEO"!==s.tagName||s.addEventListener("ended",r,!1)),"function"==typeof s.then&&s.then(i,i)})):i(),this}},{key:"_reverseIndex",value:function(t,e){for(var n=void 0,i=0;i<this.indexes.length;i++){if(e&&this.indexes[i]>=t||!e&&this.indexes[i]>t)return n;n=this.indexes[i]}return 0}}]),t}();e.default=r,t.exports=e.default});
//# sourceMappingURL=maps/screenplay.min.js.map
