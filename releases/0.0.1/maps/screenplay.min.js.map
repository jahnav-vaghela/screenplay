{"version":3,"sources":["screenplay.js"],"names":["_classCallCheck","instance","Constructor","TypeError","_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","_createClass","defineProperties","props","descriptor","enumerable","configurable","writable","defineProperty","protoProps","staticProps","context","factory","module","exports","define","amd","Screenplay","this","getEndEventName","map","animation","-o-animation","-moz-animation","-webkit-animation","transition","-o-transition","-moz-transition","-webkit-transition","div","document","createElement","eventName","style","e","settings","async","steps","indexes","markers","index","loops","playing","animationEnd","transitionEnd","events","step","play","pause","stop","loop","before","after","timer","finale","value","run","trigger","fn","repeat","push","time","next","clearTimeout","setTimeout","_repeat","last","_marker","toString","marker","filter","f","_this","forEach","undefined","nb","_reverseIndex","_this2","go","concurrentSteps","_next","bind","Array","isArray","doms","_this3","domCount","done","dom","callback","removeEventListener","addEventListener","previous","buffer"],"mappings":"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","file":"../screenplay.min.js","sourcesContent":["/*!-----------------------------------------------------------------------------\n * screenplay â€” A tiny Javascript library to timeline functions\n * v0.0.1 - built 2016-11-19\n * Licensed under the MIT License.\n * http://screenplay.jaysalvat.com/\n * ----------------------------------------------------------------------------\n * Copyright (C) 2016 Jay Salvat\n * http://jaysalvat.com/\n * --------------------------------------------------------------------------*/\nvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n/* global define */\n\n(function (context, factory) {\n    'use strict';\n\n    if (typeof module !== 'undefined' && module.exports) {\n        module.exports = factory();\n    } else if (typeof define === 'function' && define.amd) {\n        define([], factory);\n    } else {\n        context.Screenplay = factory();\n    }\n})(this, function () {\n    'use strict';\n\n    var Screenplay = function () {\n        function Screenplay(settings) {\n            _classCallCheck(this, Screenplay);\n\n            settings = _extends({}, {\n                async: true\n            }, settings);\n\n            this.async = settings.async;\n            this.steps = [];\n            this.indexes = [];\n            this.markers = {};\n            this.index = 0;\n            this.loops = 1;\n            this.playing = false;\n            this.animationEnd = getEndEventName('animation');\n            this.transitionEnd = getEndEventName('transition');\n            this.events = {\n                'step': [],\n                'play': [],\n                'pause': [],\n                'stop': [],\n                'loop': [],\n                'before': [],\n                'after': []\n            };\n            this.timer = null;\n            this.finale = function () {};\n        }\n\n        _createClass(Screenplay, [{\n            key: 'play',\n            value: function play(loops) {\n                this.loops = loops ? loops : this.loops;\n                this.playing = true;\n                this.run();\n\n                return this.trigger('play');\n            }\n        }, {\n            key: 'pause',\n            value: function pause() {\n                this.playing = false;\n                this.run();\n\n                return this.trigger('pause');\n            }\n        }, {\n            key: 'toggle',\n            value: function toggle() {\n                return this.playing ? this.pause() : this.play();\n            }\n        }, {\n            key: 'stop',\n            value: function stop() {\n                this.loops = 1;\n                this.playing = false;\n                this.finale.call(this);\n\n                return this.trigger('stop');\n            }\n        }, {\n            key: 'step',\n            value: function step(fn, repeat) {\n                repeat = repeat || 1;\n\n                for (var i = 0; i < repeat; i++) {\n                    this.steps.push(fn);\n                    this.indexes.push(this.steps.length - 1);\n                }\n\n                return this;\n            }\n        }, {\n            key: 'wait',\n            value: function wait(time) {\n                this.steps.push(function (next) {\n                    clearTimeout(this.timer);\n\n                    this.timer = setTimeout(function () {\n                        next();\n                    }, time);\n                });\n\n                return this;\n            }\n        }, {\n            key: 'repeat',\n            value: function repeat(_repeat) {\n                var last = this.steps[this.steps.length - 1];\n\n                return this.step(last, _repeat);\n            }\n        }, {\n            key: 'end',\n            value: function end(fn) {\n                this.finale = fn;\n\n                return this;\n            }\n        }, {\n            key: 'rewind',\n            value: function rewind() {\n                this.index = 0;\n                this.playing = true;\n                this.run();\n\n                return this;\n            }\n        }, {\n            key: 'marker',\n            value: function marker(_marker) {\n                this.markers[_marker.toString()] = this.steps.length;\n\n                return this;\n            }\n        }, {\n            key: 'goto',\n            value: function goto(marker) {\n                if (typeof marker === 'string') {\n                    if (this.markers[marker]) {\n                        this.index = this.markers[marker];\n                        this.run();\n                    }\n                }\n\n                if (typeof marker === 'number') {\n                    if (this.indexes[marker]) {\n                        this.index = this.indexes[marker];\n                        this.run();\n                    }\n                }\n\n                return this;\n            }\n        }, {\n            key: 'on',\n            value: function on(key, fn) {\n                this.events[key].push(fn);\n\n                return this;\n            }\n        }, {\n            key: 'off',\n            value: function off(key, fn) {\n                if (fn) {\n                    this.events[key] = this.events[key].filter(function (f) {\n                        return f !== fn;\n                    });\n                } else {\n                    this.events[key] = [];\n                }\n\n                return this;\n            }\n        }, {\n            key: 'trigger',\n            value: function trigger(key) {\n                var _this = this;\n\n                this.events[key].forEach(function (fn) {\n                    fn.call(_this);\n                });\n\n                return this;\n            }\n        }, {\n            key: 'loop',\n            value: function loop(loops) {\n                this.loops = loops !== undefined ? loops : -1;\n\n                return this;\n            }\n        }, {\n            key: 'previous',\n            value: function previous(nb) {\n                var index = this._reverseIndex(this.index - (nb || 1), true);\n\n                if (index) {\n                    this.index = index;\n                    this.run();\n                }\n\n                return this;\n            }\n        }, {\n            key: 'next',\n            value: function next(nb) {\n                var index = this._reverseIndex(this.index + (nb || 1));\n\n                if (index) {\n                    this.index = index;\n                    this.run();\n                }\n\n                return this;\n            }\n        }, {\n            key: 'same',\n            value: function same() {\n                this.index -= 1;\n                this.run();\n\n                return this;\n            }\n        }, {\n            key: 'run',\n            value: function run() {\n                var _this2 = this;\n\n                if (!this.playing) {\n                    return;\n                }\n\n                if (this.index < 0) {\n                    this.index = 0;\n                }\n\n                if (this.index >= this.steps.length) {\n                    this.index = 0;\n\n                    if (this.loops !== -1) {\n                        this.loops--;\n                    }\n\n                    if (this.loops === 0) {\n                        return this.stop();\n                    }\n                }\n\n                var go = function go() {\n                    var step = _this2.steps[_this2.index],\n                        steps = step;\n\n                    if (typeof step === 'function') {\n                        _this2.concurrentSteps = 1;\n\n                        step.call(_this2, _this2._next.bind(_this2));\n                    }\n\n                    if (Array.isArray(steps)) {\n                        _this2.concurrentSteps = steps.length;\n\n                        steps.forEach(function (step) {\n                            step.call(_this2, _this2._next.bind(_this2));\n                        });\n                    }\n                };\n\n                this.trigger('before');\n\n                if (this.async) {\n                    setTimeout(go);\n                } else {\n                    go();\n                }\n\n                return this;\n            }\n        }, {\n            key: '_next',\n            value: function _next(doms) {\n                var _this3 = this;\n\n                var domCount = 0;\n\n                var done = function done() {\n                    if (--_this3.concurrentSteps === 0) {\n                        _this3.index++;\n                        _this3.run();\n                        _this3.trigger('after');\n                    }\n                };\n\n                if (doms) {\n                    doms = Array.isArray(doms) ? doms : [doms];\n\n                    doms.forEach(function (dom) {\n                        var callback = function callback() {\n                            dom.removeEventListener(_this3.animationEnd, callback);\n                            dom.removeEventListener(_this3.transitionEnd, callback);\n\n                            if (++domCount === doms.length) {\n                                done();\n                            }\n                        };\n\n                        dom.addEventListener(_this3.transitionEnd, callback, false);\n                        dom.addEventListener(_this3.animationEnd, callback, false);\n                    });\n                } else {\n                    done();\n                }\n\n                return this;\n            }\n        }, {\n            key: '_reverseIndex',\n            value: function _reverseIndex(index, previous) {\n                var buffer = void 0;\n\n                for (var i = 0; i < this.indexes.length; i++) {\n                    if (previous && this.indexes[i] >= index || !previous && this.indexes[i] > index) {\n                        return buffer;\n                    }\n\n                    buffer = this.indexes[i];\n                }\n\n                return 0;\n            }\n        }]);\n\n        return Screenplay;\n    }();\n\n    function getEndEventName(key) {\n        var map = {\n            animation: {\n                'animation': 'animationend',\n                '-o-animation': 'oAnimationEnd',\n                '-moz-animation': 'animationend',\n                '-webkit-animation': 'webkitAnimationEnd'\n            },\n            transition: {\n                'transition': 'transitionend',\n                '-o-transition': 'oTransitionEnd',\n                '-moz-transition': 'transitionend',\n                '-webkit-transition': 'webkitTransitionEnd'\n            }\n        };\n\n        try {\n            var div = document.createElement('div');\n\n            for (var eventName in map[key]) {\n                if (typeof div.style[eventName] !== 'undefined') {\n                    return map[key][eventName];\n                }\n            }\n        } catch (e) {\n            return null;\n        }\n    }\n\n    return Screenplay;\n});\n//# sourceMappingURL=maps/screenplay.js.map\n"]}